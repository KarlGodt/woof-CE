#!/bin/ash
_say_help_msg(){
	cat >&1 <<EoI
# simple way to bulk add and commit
# changed files on system that are also
# in the git repo dir
# without user interaction
EoI
}

case $* in -h|*help) _say_help_msg; exit 0;; esac

#SAME=-s ## diff option

ME_PROG=`realpath "$0"`
ME_DIR=${ME_PROG%/*}
cd "$ME_DIR" || exit 2

_DIR_=KarlGodt_ForkWoof.Push.D
#cd "$ME_DIR"/$_DIR_/woof-code/rootfs-skeleton || exit
cd ..//woof-code/rootfs-skeleton || exit 3

FIND=`find . |sort`

while read found
do


found="${found#*/}"
#echo "$found"
[ "$found" ] || continue
[ -d "$found" ] && continue

[ "${found##*/}" = '.gitignore' ] && continue
[ "${found##*/}" = 'EMPTYDIRMARKER' ] && continue

test "`echo "$found" | grep -iE '\.gz$|\.png$|\.xpm$|\.wav$|\.au$'`" && continue

case $found in etc/*)
 case $found in etc/modprobe.d/*) continue;;
 etc/*/*) :;;
 *) continue;;
 esac
esac

[ -e /"$found" ] || { mkdir -p /"${found%/*}"; cp -a ./"$found" /"$found"; continue; }

[ -L ./"$found" ] && { realpath ./"$found" || continue; }

diff -q $SAME ./"$found" /"$found" && continue # 0 is equal, 1 is different
#echo "./$found and /$found differ"
test -L ./"$found" && continue

#cd "$ME_DIR"/$_DIR_ || exit
cd "$ME_DIR"/../

#cp -a /"$found" "$ME_DIR"/$_DIR_/woof-code/rootfs-skeleton/"$found" || { cd "$ME_DIR"/$_DIR_/woof-code/rootfs-skeleton; continue; }
cp -a /"$found" "$ME_DIR"/../woof-code/rootfs-skeleton/"$found" || { cd "$ME_DIR"/../woof-code/rootfs-skeleton; continue; }

#git add woof-code/rootfs-skeleton/"$found" || { cd "$ME_DIR"/$_DIR_/woof-code/rootfs-skeleton; continue; }
git add woof-code/rootfs-skeleton/"$found" || { cd "$ME_DIR"/../woof-code/rootfs-skeleton; continue; }
git commit -m "${found##*/} : Bulk Maintanance Replacement of today."

#cd "$ME_DIR"/$_DIR_/woof-code/rootfs-skeleton
cd "$ME_DIR"/../woof-code/rootfs-skeleton

sleep 1


done<<EOI
`echo "$FIND"`
EOI


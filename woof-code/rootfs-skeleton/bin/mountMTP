#!/bin/ash


. /etc/rc.d/f4puppy5

_pidof go-mtpfs && _exit 3 "go-mtpfs already running -- use umountMTP"


test -L /bin/mount    || _exit 4 "/bin/mount needs to be a link"
test -e /bin/mountBAK || cp -a /bin/mount /bin/mountBAK

test -e /bin/mountMTP.sh || {
echo 'exit 0' >/bin/mountMTP.sh
chmod +x /bin/mountMTP.sh
}

OLD_MOUNT=`realpath /bin/mount`

ln -sf mountMTP.sh /bin/mount || _exit 5 "Could not create link /bin/mount -> mountMTP.sh"


MOUNT_POINT=/mntf/MTPdev
test -e "$MOUNT_POINT" || mkdir -p "$MOUNT_POINT"

GO_MTPFS_OPS=
go-mtpfs $GO_MTPFS_OPS "$MOUNT_POINT" &

sleep 5

ln -sf "$OLD_MOUNT" /bin/mount

#!/bin/sh

Version='1.1-simple Macpup_O2-Puppy_Linux_431 KRG'

ERR=/dev/null;OUT=$ERR;VERB='';L_VERB='';A_VERB='';QUIET='-q'; ##+++2012-03-10
[ "$DEBUG" ] && { ERR=/dev/stderr;OUT=/dev/stdout;VERB=-v;L_VERB=--verbose;A_VERB=-verbose;QUIET=''; }
#pidof X 1>$OUT 2>$ERR && { echo "X is still running. Please run wm${0##*/}. Exiting script.";exit 1; }

usage(){ echo "help for $0:
When run , checks if X not running .
If X is running executing `which wmpoweroff` .
wmpoweroff and $0
do run /etc/rc.d/rc.shutdown
and are finally executing /bin/busybox poweroff ." ; }

PARAMETERS="$@"
#PARAMETERS=`echo "$PARAMETERS" | tr '[[:upper:]]' '[[:lower:]]'`
for param in $PARAMETERS; do
echo $param
case $param in
h|-h|help|-help|--help) usage;exit 1;;
D|-D|debug|-debug|--debug) DEBUG=1;;
v|-v|verbose|-verbose|--verbose) VERBOSE=1;;
q|-q|quiet|-quiet|--quiet) QUIET=1;;
s|-s|silent|-silent|--silent) SILENT=1;;
*) BB_PARAMS="$BB_PARAMS $param";;
esac
done

#if [ -n "`ps | grep 'X :' | grep -v 'grep'`" ]; then
if [ "`pidof X`" ]; then
exec wmpoweroff $PARAMETERS
exit
fi

RETval=''
/etc/rc.d/rc.shutdown $PARAMETERS || RETval=$?
if [ "$RETval" ];then
case $RETval in
199) echo;return 0 2>$ERR || exit 0;;
*)
echo -e "\n\e[1;31m""$0:ERROR: < $RETval > canceling rc.shutdown""\e[0;39m"
return $RETval 2>$ERR || exit $RETval
;;
esac
fi
echo "Executing /bin/busybox poweroff '$BB_PARAMS'"
exec /bin/busybox poweroff $BB_PARAMS

#!/bin/sh
#110505 support sudo for non-root user.
#120408 support minit

[ "`whoami`" = "root" ] || exec sudo -A ${0} ${@} #110505

# REM: Some variables to print before
#      finally rebooting
timeOUT=5
. /etc/DISTRO_SPECS
KERNEL=`uname -r`
if test -f /proc/cmdline; then
read cmdLINE </proc/cmdline
fi

/etc/rc.d/rc.shutdown ${@}   #for passing parrameters like -v --verbose

POWEROFFEXE='/bin/busybox poweroff'
#[ -f /sbin/minit ] && POWEROFFEXE='/sbin/shutdown -o' #-o means poweroff.
                                                       #note: shutdown is part of minit pkg.
[ -f /sbin/minit -a -x /sbin/minit ] && POWEROFFEXE='hard-reboot POWER_OFF'
                                                       #note: hard-reboot is part of minit pkg.

case "$POWEROFFEXE" in
"/bin/busybox poweroff")
 for parameter in ${@} ; do
  case $parameter in
   -d[0-9]*|[0-9]*|-n|-f) :     ;;
                       *) shift ;;
# BusyBox v1.22.0.git (2013-06-22 02:42:56 GMT+1) multi-call binary.
# Usage: poweroff [-d DELAY] [-n] [-f]
# Halt and shut off power
# -d SEC    Delay interval
# -n        Do not sync
# -f        Force (don't go through init)
  esac;done
;;
"hard-reboot POWER_OFF")
 for parameter in ${@} ; do
 shift
 #SYNOPSIS
 #      hard‐reboot RESTART
 #      hard‐reboot HALT
 #      hard‐reboot POWER_OFF
 done
;;
esac

echo "
$DISTRO_NAME $DISTRO_VERSION
kernel $KERNEL
$cmdLINE

${POWEROFFEXE} ${@}
:"
sleep $timeOUT
exec ${POWEROFFEXE} ${@} #>/dev/null 2>&1

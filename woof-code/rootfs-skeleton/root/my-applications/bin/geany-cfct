#!/bin/sh


echo '${0%/*}'"${0%/*}"
echo '${0%%/*}'"${0%%/*}"
echo '${0%*/}'"${0%*/}"
echo '${0%%*/}'"${0%%*/}"

echo '${0#/*}'"${0#/*}"
echo '${0##/*}'"${0##/*}"
echo '${0#*/}'"${0#*/}"
echo '${0##*/}'"${0##*/}"

echo '`pwd`'"`pwd`"
START_DIRECTORY="`pwd`"

PROGRAM_NAME_LONG='geany-change-filetype-custom-template'
PROGRAM_NAME='geany-cfct'

help_func(){

cat 1>&2 << EOT

Usage: `basename $0` filename to use

Copies the filename to 'filetypes.MIME'

OPTIONS :

-l | --list ) shows available templates in '/usr/share/geany' .
               An additional term like 'sh' would show available
               templates for this term .


EOT

}


if [ ! "$1" ] || [ "$1" = "-h" -o "$1" = "-help" -o "$1" = "--help"  ] ; then

echo
echo "$PROGRAM_NAME reqiures an argument ."

help_func

exit

fi

case "$1" in

-l|--list)

if [ -z "$2" ] ; then

FILETYPE_TEMPLATES=`find /usr/share/geany -type f -name "*.*" | sort -f -k 2 -t '.'`

if [ -n "$FILETYPE_TEMPLATES" ] ; then

echo "$FILETYPE_TEMPLATES"

else

echo -e "\e[31mNo filetype templates found in '/usr/share/geany'\e[39m"

fi

else

FILETYPE_TEMPLATES=`find /usr/share/geany -type f -name "*.$2*" | sort -f -k 2 -t '.'`

if [ -n "$FILETYPE_TEMPLATES" ] ; then

echo "$FILETYPE_TEMPLATES"

else

echo -e "\e[31mNo filetype templates found for '$2' in '/usr/share/geany'\e[39m"

fi

fi

exit
;;

esac

if [ -d /usr/share/geany ] ; then

cd /usr/share/geany

TEMPLATE_FILE="`basename $1 | sed 's#^filetype\.##'`"
TEMPLATE_FILE="filetypes.${TEMPLATE_FILE}"

NEW_TEMPLATE_FILE="`basename ${TEMPLATE_FILE} | cut -f 1-2 -d '.'`"

echo "$TEMPLATE_FILE $NEW_TEMPLATE_FILE"

if [ -f ./$TEMPLATE_FILE ] ; then

echo -e "\e[1;31m`pwd` :\e[0;39m"

cp -i ./$TEMPLATE_FILE ./$NEW_TEMPLATE_FILE
ERC=$?

echo "Error Return Code is :$ERC:"

else

echo -e "\e[31mError , desired file does not exists\e[39m"

fi

else

echo -e "\e[31mDirectory '/usr/share/geany' does not exists\e[39m"

fi

cd "$START_DIRECTORY"

exit


#!/bin/sh
#the way this file is written, it is best to start Icewm with just "icewm"
DIR=$HOME/icewm
CURWM=`cat /etc/windowmanager|head -c5` #this is a workaround if icewm was started with "icewm-session"
if [[ "$CURWM" != icewm ]];then exit
fi

. $HOME/.icewm/theme
THEMEDIR="/usr/share/icewm/themes"
. ${THEMEDIR}/${Theme} 2>/dev/null
NUMCOLOR=`echo $ColorNormalTaskBarApp|grep "rgb:"`
if [[ $NUMCOLOR = "" ]];then BG=""
	else PRE_BG=`echo $ColorNormalTaskBarApp|cut -d ':' -f2|sed 's%/%%g'`
		 BG="#${PRE_BG}"
fi
if [[ $Theme = "GoldenSand/default.theme" ]];then BG="#C6AD73"
fi

if [ "$BG" = "" ];then OPTARG=""
	else OPTARG="-bg ${BG}"
fi
echo $OPTARG

#let's get started #battery and numlockx usually start ok, so they are omitted
killall icewmtray
icewmtray & 2>/dev/null 
/root/Startup/powerapplet_tray & 2>/dev/null
sleep 1
FWALL=`ls /root/Startup|grep firewall`
if [[ -x /root/Startup/${FWALL} ]];then exec $FWALL & 2>/dev/null
	sleep 3
fi
killall retrovol 2>/dev/null
if [ "$OPTARG" = "" ];then retrovol -hide & 2>/dev/null
		else retrovol $OPTARG -hide & 2>/dev/null
fi
sleep 2
killall blinky 2>/dev/null
$DIR/blinky $OPTARG & 2>/dev/null
sleep 2
$DIR/freememapplet_tray & 2>/dev/null

exit
#END


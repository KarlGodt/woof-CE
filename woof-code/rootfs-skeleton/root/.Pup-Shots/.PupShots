#!/bin/sh
# (c) Copyright 2009 ttuuxxx www.ttuuxxx.com
#2007 Lesser GPL licence v2 (http://www.fsf.org/licensing/licenses/lgpl.html)
# This script is a GUI I made for a command line screenshot utility called scrot, . 
#
#Modifications by MinHundHettePerro (MHHP) 2009, to make the script more modular and introducing
#selectable delay-time, filetype, quality/compression, show/hide Pup-Shot window.
#"actions" moved to PupShot_file_p
# Large/small height of window now determined automatically; Screen height less than or equal to 
# h=600 gives small Pup-Shot window.
SCRNXY="`xwininfo -root | grep -o '\-geometry .*' | tr -s ' ' | cut -f 2 -d ' ' | cut -f 1 -d '+'`"
#SCRN_X="`echo -n "$SCRNXY" | cut -f 1 -d 'x'`"
SCRN_Y="`echo -n "$SCRNXY" | cut -f 2 -d 'x'`"
cam_pic='/usr/local/lib/X11/pixmaps/camera48.png'
[ $SCRN_Y -le 600 ] && cam_pic='/usr/local/lib/X11/mini-icons/mini-camera.xpm'
SF='/root/.Pup-Shots/.PupShots_settings_p'
D_def="<item>5</item>"
HPSW_def="true"
hpsw_def="false"
Ft_def="<item>jpg</item>"
QC_def="<item>85</item>"
if [ -e $SF ];then
D_ddef=`cat $SF|head -1|tail -n 1`
D_def="<item>$D_ddef</item>"
HPSW_def=`cat $SF|head -2|tail -n 1`
hpsw_def="false"
[ "$HPSW_def" = "false" ] && hpsw_def="true"
Ft_ddef=`cat $SF|head -3|tail -n 1`
Ft_def="<item>$Ft_ddef</item>"
QC_ddef=`cat $SF|head -4|tail -n 1`
QC_def="<item>$QC_ddef</item>"
fi
SS_def="false"
#echo "SF ="$SF
PupShots_L_SP=
[ $SCRN_Y -gt 600 ] && PupShots_L_SP="<text><label>\"       \"</label></text>"
DELAY="<item>1</item>
<item>2</item>
<item>3</item>
<item>4</item>
<item>5</item>
<item>10</item>
<item>15</item>
<item>20</item>
<item>30</item>
<item>40</item>
<item>60</item>"  
Ft="<item>jpg</item>
<item>png</item>
<item>bmp</item>
<item>tiff</item>"
QC="<item>100</item>
<item>95</item>
<item>90</item>
<item>85</item>
<item>80</item>
<item>75</item>
<item>70</item>
<item>65</item>
<item>60</item>
<item>55</item>
<item>50</item>
<item>45</item>
<item>40</item>
<item>35</item>
<item>30</item>
<item>25</item>
<item>20</item>
<item>15</item>
<item>10</item>
<item>5</item>" 

PupShots_HEAD=" 
<window title=\"Pup-Shots\" icon-name=\"gtk-preferences\">
<vbox>
 
 <hbox>
 <vbox>
 <text><label>Pup-Shots Screenshot Utility</label></text>
<pixmap>
     <input file>$cam_pic</input> 
    </pixmap> 
	   	       <text><label>The Screenshot will be in /root with a date/time stamp on it.</label></text>
	  </vbox>
	  </hbox>"

PupShots_DELAY=" 
	  <hbox>
	  <vbox>
	  <vbox>
   <text>
    <label>Delay (s)</label> 
   </text>
     <combobox>
	  <variable>DT</variable>
     $D_def
	 $DELAY
	 </combobox>
   </vbox>"

PupShots_HPSW=" 
	  <vbox>
          <text>
	 <label>Pup-Shot window</label> 
	 </text>
	 <hbox>  
	           <radiobutton>
              <label>Hide</label>
              <variable>HPSW</variable>
	          <default>$HPSW_def</default>
            </radiobutton>
            <radiobutton>
              <label>Show</label>
              <variable>hpsw</variable>
	          <default>$hpsw_def</default>
            </radiobutton>
     <text>
	 <label>\"         \"</label> 
	 </text>
	 </hbox>
   </vbox>
 </vbox>"

PupShots_FILE_TYPE=" 
 <vbox>
	  <vbox>
     <text>
	 <label>File type</label> 
	 </text>
	 <combobox>       
	   	  <variable>FTT</variable>
	  $Ft_def
	  $Ft
	  </combobox>
   </vbox>"

PupShots_QUALITY=" 
	  <vbox>
     <text>
	 <label>Quality/Compression</label> 
	 </text>
	 <combobox>       
	   	  <variable>Q</variable>
	  $QC_def
	  $QC
	  </combobox>
   </vbox>
   </vbox>
   </hbox>"

  PupShots_ALT1=" 
  <hbox>
   <text>
    <label>Fullscreen image save to root </label> 
   </text>
   <button>
    <input file>/usr/local/lib/X11/mini-icons/gtk-fullscreen.png</input> 
    
	<action>/root/.Pup-Shots/.PupShots_file_p -alt1</action>
  <action type=\"closewindow\">DIALOG</action>
   </button>
  </hbox>"
  
PupShots_ALT2=" 
  <hbox>
   <text>
    <label>Fullscreen image edit/save with image viewer </label> 
   </text>
   <button>
    <input file>/usr/local/lib/X11/pixmaps/paint24-1.png</input>
    <action>/root/.Pup-Shots/.PupShots_file_p -alt2</action>
	<action type=\"closewindow\">DIALOG</action>
   </button>
  </hbox>"
  
PupShots_ALT3=" 
   <hbox>
   <text>
    <label>Select Region (hold the Left Mouse Button and drag) </label>
   </text>
   <button>
    <input file>/usr/local/lib/X11/mini-icons/SelectRegion.png</input>
    <action>/root/.Pup-Shots/.PupShots_file_p -alt3</action>
	<action type=\"closewindow\">DIALOG</action>
   </button>
  </hbox>"
  
PupShots_ALT4=" 
<hbox>
   <text>
    <label>Select Window (Left click on window of choice.)</label>
   </text>
   <button>
    <input file>/usr/local/lib/X11/mini-icons/selectwindow.png</input>
    <action>/root/.Pup-Shots/.PupShots_file_p -alt4</action> 
	<action type=\"closewindow\">DIALOG</action>
   </button>
  </hbox>"
  
PupShots_ALT5=" 
<hbox>
   <text>
    <label>Select window without borders</label>
   </text>
   <button>
    <input file>/usr/local/lib/X11/mini-icons/selectwindow-noborders.png</input>
    <action>/root/.Pup-Shots/.PupShots_file_p -alt5</action>
	<action type=\"closewindow\">DIALOG</action>
   </button>
  </hbox>"
  
PupShots_ALT6=" 
<hbox>
   <text>
    <label>Scale fullscreen image to w=600, for forum posting</label>
   </text>
   <button>
    <input file>/usr/local/lib/X11/mini-icons/window_nofullscreen.png</input>
    <action>/root/.Pup-Shots/.PupShots_file_p -alt6</action>
	<action type=\"closewindow\">DIALOG</action>
   </button>
  </hbox>"
  
PupShots_TAIL=" 
  <hbox>
   <text>
    <label>\"       \"</label> 
   </text>
 
 <vbox>
 			    <checkbox>
                  <label>Save Settings</label>
                  <variable>SS</variable>
	              <default>$SS_def</default>
                </checkbox>

 </vbox>
 <vbox>
   <text>
    <label>\"       \"</label> 
   </text>
 
 </vbox>
 <vbox>
  <button>
  <label>Cancel  </label> 
        <input file>/usr/local/lib/X11/pixmaps/shutdown24.png</input>
	<action type=\"closewindow\">DIALOG</action> 
	      </button>
 </vbox> 
 </hbox>

</vbox>
 
     </window>
"


echo '#!/bin/sh' > /tmp/pupshot_gui
echo "$PupShots_HEAD" > /tmp/pupshot
echo "$PupShots_DELAY" >> /tmp/pupshot
echo "$PupShots_HPSW" >> /tmp/pupshot
echo "$PupShots_FILE_TYPE" >> /tmp/pupshot
echo "$PupShots_QUALITY" >> /tmp/pupshot
echo "$PupShots_L_SP" >> /tmp/pupshot
echo "$PupShots_ALT1" >> /tmp/pupshot
echo "$PupShots_L_SP" >> /tmp/pupshot
echo "$PupShots_ALT2" >> /tmp/pupshot
echo "$PupShots_L_SP" >> /tmp/pupshot
echo "$PupShots_ALT3" >> /tmp/pupshot
echo "$PupShots_L_SP" >> /tmp/pupshot
echo "$PupShots_ALT4" >> /tmp/pupshot
echo "$PupShots_L_SP" >> /tmp/pupshot
echo "$PupShots_ALT5" >> /tmp/pupshot
echo "$PupShots_L_SP" >> /tmp/pupshot
echo "$PupShots_ALT6" >> /tmp/pupshot
echo "$PupShots_L_SP" >> /tmp/pupshot
echo "$PupShots_TAIL" >> /tmp/pupshot
echo 'gtkdialog3 --file=/tmp/pupshot --center &' >> /tmp/pupshot_gui
chmod 744 /tmp/pupshot_gui
/tmp/pupshot_gui

unset PupShots
exit 0


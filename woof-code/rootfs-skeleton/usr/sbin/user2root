#!/bin/sh
#(c) copyright Barry Kauler, May 2013, bkhome.org
#License GPL3 (refer /usr/share/doc/legal).
# Called from /usr/sbin/loginmanager, to change back to 'root'.
# May also be called standalone.
#130527 first version.

NOWUSER="`whoami`"
[ "$NOWUSER" != "root" ] && exec sudo -A ${0} ${@}

export TEXTDOMAIN=user2root
export OUTPUT_CHARSET=UTF-8

  _TITLE_="pup_user2root.sh"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="$0"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
 set +e
 source /etc/rc.d/f4puppy5 && {
 set +n
 source /etc/rc.d/f4puppy5; } || echo "WARNING : Could not source /etc/rc.d/f4puyppy5 ."

ADD_PARAMETER_LIST=
ADD_PARAMETERS=
_provide_basic_parameters

TWO_HELP=''; TWO_VERSION=''; TWO_VERBOSE=''; TWO_DEBUG=''; ## Set to anything if code requires further down (ie. custom usage or version message)
ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
for i in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap
} || echo "Warning : No /etc/rc.d/f4puppy5 installed."

#change auto login back to root...
rootEXPR="s%^tty1.*%tty1::respawn:/sbin/mingetty --autologin root tty1%"
sed -i -e "$rootEXPR" /etc/inittab #110507 TaZOC bug fix.
#120409 if using minit instead of busybox init...
if [ -f /etc/minit/getty/1/params  ];then #see my minit pet pkg.
 EXPR2='s%^fido$%root%'
 sed -i -e "$EXPR2" /etc/minit/getty/1/params
fi
pupmessage -bg green -center -title "$(gettext 'Login Manager: OK')" "$(gettext 'Ok, you will be administrator at next boot')"

###END###

#!/bin/bash
#BK nov 2007 gui frontend for dict.
# 2010-05-26 ecube: refurbishing

  _TITLE_=
_COMMENT_=""

MY_SELF="$0"

test -f /etc/rc.d/f4puppy5 && {
 set +e
 source /etc/rc.d/f4puppy5 && {
 set +n
 source /etc/rc.d/f4puppy5; } || echo "WARNING : Could not source /etc/rc.d/f4puyppy5 ."

ADD_PARAMETER_LIST=
ADD_PARAMETERS=
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
for i in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap
} || echo "Warning : No /etc/rc.d/f4puppy5 installed."

WIDTH=550; HEIGHT=700

echo -n "" > /tmp/pdict-results.txt

if [ "`ls $HOME/.dict_dbs`" = "" ]; then
  `dict --dbs > $HOME/.dict_dbs`
fi

DICTLIST="`cat $HOME/.dict_dbs`"
COMBOCONTENT="`echo "$DICTLIST" | grep -v '^Databases available:' | sed -e 's/^/<item>/' | sed -e 's/$/<\/item>/'`"

export MAIN_DIALOG="
<window title=\"Pdict dictionary and thesaurus\" icon-name=\"gtk-info\">
 <vbox>
  <hbox>
   <button>
    <label>config</label>
<action type=\"execute\"> Xdialog --title \"DICT databases\" --msgbox \"Initialize the list of databases by deleting the hidden file $HOME/.dict_dbs.\" 5 70</action>
    <action type=\"execute\">/usr/local/bin/defaulttexteditor $HOME/.dict_dbs</action>
    <action type=\"execute\">yaf-splash  -timeout 5 -font \"9x15B\" -outline 0 -margin 4 -bg cyan -text \"Restart pdict to activate the configuration\" &</action>
   </button>

   <entry activates-default=\"true\">
    <variable>WORD</variable>
   </entry>
   <text><label>enter a word:</label></text>

   <button>
    <label>dict</label>
    <action>dict -d \${DB%  *} \$WORD &>/tmp/pdict-results.txt</action>
    <action>refresh:INFO</action>
   </button>

  </hbox>
  <text><label>Choose which online database:</label></text>
  <combobox>
   <variable>DB</variable>
    $COMBOCONTENT
  </combobox>
  <frame result:>
   <edit>
    <variable>INFO</variable>
    <input file>/tmp/pdict-results.txt</input>
    <width>$WIDTH</width>
    <height>$HEIGHT</height>
   </edit>
  </frame>
  <hbox>
   <button>
    <label>exit</label>
    <input file stock=\"gtk-quit\"></input>
    <action type=\"exit\">EXIT</action>
   </button>
  </hbox>
 </vbox>
</window>
"
gtkdialog3 --program=MAIN_DIALOG

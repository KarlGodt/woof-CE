#!/bin/sh
#2007 Lesser GPL licence v2 (http://www.fsf.org/licensing/licenses/lgpl.html)
#v3.97 BK bugfix.

__old_header__(){
###KRG Fr 31. Aug 23:34:58 GMT+1 2012

trap "exit 1" HUP INT QUIT KILL TERM

OUT=/dev/null;ERR=$OUT
[ "$DEBUG" ] && { OUT=/dev/stdout;ERR=/dev/stderr; }
[ "$DEBUG" = "2" ] && set -x

Version='1.1'

usage(){
USAGE_MSG="
$0 [ PARAMETERS ]

-V|--version : showing version information
-H|--help : show this usage information

*******  *******  *******  *******  *******  *******  *******  *******  *******
$2
"
exit $1
}

[ "`echo "$1" | grep -wE "\-help|\-H"`" ] && usage 0
[ "`echo "$1" | grep -wE "\-version|\-V"`" ] && { echo "$0 -version $Version";exit 0; }

###KRG Fr 31. Aug 23:34:58 GMT+1 2012
}

  _TITLE_=
_COMMENT_=

MY_SELF="$0"

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap
}

if [ -f /usr/sbin/cfdisk -o -f /sbin/cfdisk ];then #v3.97
 BUTMANAGE="fdisk:20,cfdisk:21"
else
 BUTMANAGE="fdisk:20"
fi

ALLINFO=`probedisk 2>/dev/null | grep -v "cdrom|" | grep -v "/scd"`
ALLPARTS=`echo "$ALLINFO" | cut -f 1 -d "|" | cut -f 3 -d "/"`
ALLMNTD=`/bin/df | grep "/dev/" | cut -f 1 -d " " | grep -v "loop"`

butval=20
BUTPARTS=""
oldIFS="$IFS"
IFS=$'\n'
for eachPART in $ALLPARTS
do
BUTPARTS="${BUTPARTS}$eachPART:$butval,"
butval=`expr $butval + 1`
done
IFS="$oldIFS"
BUTPARTS="${BUTPARTS}EXIT:10"

xmessage -bg "#8080ff" -center -name "Pdisk" -title "Pdisk drive partition manager" -buttons $BUTPARTS "Welcome, this program enables you to run either fdisk, or, if it is
installed, cfdisk. These are utility applications to examine and
modify disk drive partitions. This includes creating and erasing
partitions, so is not for the faint-of-heart!

Here are the disk drives that Puppy knows about:
$ALLINFO

If any drive is wrong or missing, exit this program and run the
\"Mount/unmount drives\" program, that you will find in the \"File
Managers\" menu. That tool will enable you to probe the hardware.

These partitions are curently mounted:
$ALLMNTD
...you can view these but NOT change them.

To continue this program, click a drive button..."

RETVAL=$?
if [ $RETVAL -lt 11 ];then
 exit
fi

EDITPART=`echo "$BUTPARTS" | tr "," "\n" | grep "$RETVAL" | cut -f 1 -d ":"`

xmessage -bg "#80C080" -center -name "Pdisk" -title "Pdisk drive partition manager" -buttons $BUTMANAGE,EXIT:10 "Chose the partition manager program that you want to use..."

RETVAL=$?
if [ $RETVAL -lt 11 ];then
 exit
fi

if [ $RETVAL -eq 21 ];then
 rxvt -bg "#C080ff" -e cfdisk /dev/$EDITPART
else
 rxvt -bg "#C080ff" -e fdisk /dev/$EDITPART
fi

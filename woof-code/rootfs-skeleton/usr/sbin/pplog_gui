#! /bin/sh
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_pplog_gui"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/sbin/pplog_gui"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
[ "$HAVE_F4PUPPY5" ] || source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

TWO_HELP=''; TWO_VERSION=''; TWO_VERBOSE=''; TWO_DEBUG=''; ## Set to anything if code requires further down (ie. custom usage or version message)
ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap

}
# End new header
#
#(c) Barry Kauler July 2008, licence: GPL2

#************
#KRG

OUT=/dev/null;ERR=$OUT
[ "$DEBUG" ] && { OUT=/dev/stdout;ERR=/dev/stderr; }
[ "$DEBUG" = 2 ] && set -x

Version=1.1-KRG-MacPup_O2

usage(){
MSG="
$0 [ help | version ]
"
echo "$MSG
$2"
exit $1
}
[ "`echo "$1" | grep -Ei "help|\-h"`" ] && usage 0
[ "`echo "$1" | grep -Ei "version|\-V"`" ] && { echo "$0: $Version";exit 0; }

trap "exit" HUP INT QUIT ABRT KILL TERM

#KRG
#************


PSSTATUS=`ps`
if [ "`echo "$PSSTATUS" | grep ' hiawatha'`" = "" ];then
 xmessage -center -bg '#ffc0c0' -buttons START:10,EXIT:11 -title "PPLOG personal blog" "PPLOG personal blog requires the Hiawatha web server to be running.
Click the START button to do this, otherwise click EXIT to abort."
 [ $? -ne 10 ] && exit

 echo ''   >/tmp/hiawatha_error
 hiawatha 2>/tmp/hiawatha_error

 if [ $? -ne 0 ];then
  ERRMSG=`cat /tmp/hiawatha_error`
  xmessage -center -bg 'red' -buttons EXIT:10 -title "PPLOG personal blog" "There was an error when attempting to start Hiawatha, this error message:

${ERRMSG}

Click EXIT button to quit:"
  exit
 fi
fi

xmessage -center -bg 'orange' -buttons PPLOG:10,STOP:11,EXIT:12 -title "PPLOG personal blog" "
Click the PPLOG button to run the PPLOG personal blog.

The Hiawatha web server is currently running, which is required for PPLOG.
If you want to stop the server and exit, click the STOP button.

To just quit, click the EXIT button:"

case $? in
 10)
  exec defaulthtmlviewer http://127.0.0.1:80/blog/pup_pplog.pl
 ;;
 11)
  hiawatha.run stop
  exit
 ;;
 *)
  exit
 ;;
esac

###END###

#!/bin/sh
#100704 this was originally in Nathan's Wallpaper package.
. /etc/rc.d/f4puppy5
# BATCHMARKER01 - Marker for Line-Position to bulk insert code into.
# called by 'pwallpaper' wallpaper setter.


# Remember our actual place in the system
CURDIR="`pwd`"
# Determine the path to this application.
APPDIR=`dirname "$0"`
# Now change into dir of application
cd "${APPDIR}"
# Again set APPDIR - should be same as dirname "$0"
APPDIR="`pwd`"
# change back into our actual place in the system
cd "${CURDIR}"

# parameter -clear to delete any backdrop entries to leave a light_gray background and exit
if [ "$1" = "-clear" ];then
 mkdir -p "$HOME/.config/wallpaper"
 grep -v '<backdrop' "$HOME/.config/rox.sourceforge.net/ROX-Filer/pb_default"  > "$HOME/.config/wallpaper/pb"
 mv -f "$HOME/.config/wallpaper/pb" "$HOME/.config/rox.sourceforge.net/ROX-Filer/pb_default"
 rox -p=default
 echo "[none]" > "$HOME/.config/wallpaper/bg_img"
 exit $?
fi

# Determine Tiling mode of background
MODE="`cat $HOME/.config/wallpaper/backgroundmode`"
[ "$MODE" = "" ]        && MODE="Scale"
[ "$MODE" = "Centred" ] && MODE="Centre"
[ "$MODE" = "Scaled" ]  && MODE="Scale"

#w482 BK now have script that truncates an image vertically so that it has the right dimensions
#for a widescreen...
if [ "$MODE" = "Stretch" ];then
 /usr/sbin/background_reshape "${1}"
fi

rox --RPC << EOF
<?xml version="1.0"?>
<env:Envelope xmlns:env="http://www.w3.org/2001/12/soap-envelope">
 <env:Body xmlns="http://rox.sourceforge.net/SOAP/ROX-Filer">
  <SetBackdrop>
   <Filename>$1</Filename>
   <Style>$MODE</Style>
  </SetBackdrop>
 </env:Body>
</env:Envelope>

EOF

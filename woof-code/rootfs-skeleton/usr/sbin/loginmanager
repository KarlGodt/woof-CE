#!/bin/sh
#110507 TaZOC bug fix.

HOMEUSER="`whoami`"

CHANGE2ROOT=""
if [ "$HOMEUSER" != "root" ];then
 CHANGE2ROOT="<text><label>However, if you wish, you can change to the administrator (root) permanently on the next boot. Just tick this box and it will be so:</label></text>
  <checkbox>
   <label>Tick box to become administrator permanently</label>
   <default>false</default>
   <variable>CHECKADMIN</variable>
  </checkbox>
  <hbox>
   <entry invisible_char=\"x\" visibility=\"false\">
    <variable>ADMINPASSWORD</variable>
   </entry>
   <text><label>Type admin password here</label></text>
  </hbox>
 <text><label>This will take affect after reboot.</label></text>
 "

fi


export MAIN_DIALOG="
<window title=\"LoginManager\" icon-name=\"gtk-execute\">
 <vbox>
  <text use-markup=\"true\"><label>\"<b>Currently you are logged in as '${HOMEUSER}'</b>\"</label></text>
  
  ${CHANGE2ROOT}
  
  <hbox>
   <button ok></button>
   <button cancel></button>
  </hbox>
 </vbox>
</window>
"


RETSTRING="`gtkdialog3 --program=MAIN_DIALOG --center`"
[ $? -ne 0 ] && exit

#echo "$RETSTRING"
eval "$RETSTRING"
[ "$EXIT" != "OK" ] && exit

#if [ "$CHANGE2ROOT" != "" ];then
 if [ "$CHECKADMIN" = "true" ];then
  echo "$ADMINPASSWORD" | su root
  if [ $? -ne 0 ];then
   xmessage -bg red -center "Sorry, admin password is wrong"
   exit
  fi
  rootEXPR="s%^tty1.*%tty1::respawn:/sbin/mingetty --autologin root tty1%"
  sed -i -e "$rootEXPR" /etc/inittab #110507 TaZOC bug fix.
  xmessage -bg green -center "Ok, you will be administrator at next boot"
 fi
#fi

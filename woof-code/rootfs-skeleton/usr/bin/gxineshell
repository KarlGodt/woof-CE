#!/bin/sh


  _TITLE_="pup_gxineshell.sh"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="$0"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
[ "$HAVE_F4PUPPY5" ] || source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

TWO_HELP=''; TWO_VERSION=''; TWO_VERBOSE=''; TWO_DEBUG=''; ## Set to anything if code requires further down (ie. custom usage or version message)
ADD_HELP_MSG=""
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap
}

#rm -f  /tmp/gxineerror.log 2>/dev/null
echo "
`date`
$0: '$@'
" >>/tmp/gxineerror.log

export LD_LIBRARY_PATH=/usr/lib:$LD_LIBRARY_PATH

GXINE=`which gxine`
[ -x /usr/local/bin/gxine ] && GXINE=/usr/local/bin/gxine
[ -x /usr/bin/gxine ] && GXINE=/usr/bin/gxine
[ -e "$GXINE" ] || { echo "No gxine installed in PATH . Exiting";exit 1; }

#v3.99 bugfix: when a file with full path, prefix with file://
PREFILE=''
#[ "`echo "$@" | grep ':/'`" = "" ] && [ -f "$@" ] && PREFILE='file://'
[ "`echo "$@" | cut -b 1`" = "/" ] && [ -f "$@" ] && PREFILE='file://'

SCRNSAVE=`xset q | grep "timeout:" | tr -s " " | cut -f 3 -d " "`
if [ $SCRNSAVE -ne 0 ];then
 xset s off -dpms #v426 bugfix
 #gxine ${PREFILE}"$@" 2>> /tmp/gxineerror.log
 $GXINE ${PREFILE}"$@" 2>> /tmp/gxineerror.log
 xset s on +dpms #v426
else
 #gxine ${PREFILE}"$@" 2>> /tmp/gxineerror.log
 $GXINE ${PREFILE}"$@" 2>> /tmp/gxineerror.log
fi

if [ -s /tmp/gxineerror.log ];then
 if [ ! "`grep 'Error loading library' /tmp/gxineerror.log`" = "" ];then
  if [ "`cat /root/.packages/packages.txt /root/.packages/livepackages.txt | grep '"mplayer_codecs_full' | grep '" on "'`" = "" ];then #'Geany
   xmessage -center -bg '#FF8080' -title "Gxine ERROR" "Gxine failed to load a codec file required to play the media file.
There is a PET package with extra codecs, called 'mplayer_codecs_full'.
Please run the PETget package manager and install it -- click the
'install' button on the desktop or run from the 'Setup' menu."
  fi
 fi
fi

###END###

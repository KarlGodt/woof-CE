#!/bin/sh
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_wvdialshell"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/bin/wvdialshell"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap

}
# End new header
#

if [ ! -e /etc/wvdial.conf ];then
 #echo "Running wvdialconfig..."

 xmessage -center -bg orange -title "Wvdial" -buttons "" "Wait, detecting modem..." &
 wvdialconf /etc/wvdial.conf
 RETVAL=$?
 killall xmessage

 if [ $RETVAL -eq 0 ];then
  gtk-shell --title "Wvdial: Edit file, click Save button to continue" --edit-file "/etc/wvdial.conf"
 else
  #modem not detected.
  xmessage -center -bg red -title "Wvdial: error" "Modem not detected. Press OK button to quit..."
  exit
 fi
fi

#xmessage -center -bg red -title "Wvdial" "Now dialing..."

#/etc/ppp/peers/wvdial clashes with Gkdial, so keep wvdial
#in /etc/ppp/ until needed.

cp -f /etc/ppp/wvdial /etc/ppp/peers/
[ -f /etc/ppp/wvdial-pipe ] && cp -f /etc/ppp/wvdial-pipe /etc/ppp/peers/ #for wvdial 1.5x

rxvt -geometry 80x5 -bg green -title "wvdial: close window to disconnect" -e wvdial

rm -f /etc/ppp/peers/wvdial
[ -f /etc/ppp/peers/wvdial-pipe ] && rm -f /etc/ppp/peers/wvdial-pipe

killall wvdial
killall pppd

#!/bin/sh
#(c) Copyright Barry Kauler March 2012, bkhome.org
#License GPL3 (refer /usr/share/doc/legal).
# This script is a replacement for 'xmessage'.
# Two reasons: 1: better appearance than gxmessage, 2: non-English text.
#120323 first version. only a partial replacement for xmessage.

__old_header__(){  #BEGIN
trap "exit 1" HUP INT QUIT KILL TERM

OUT=/dev/null;ERR=$OUT
[ "$DEBUG" ] && { OUT=/dev/stdout;ERR=/dev/stderr; }
[ "$DEBUG" = "2" ] && set -x

Version='1.1'

usage () {
USAGE_MSG="
$0 [ PARAMETERS ]

-V|--version : showing version information
-H|--help : show this usage information

*******  *******  *******  *******  *******  *******  *******  *******  *******
$2
"
exit $1
}

#[ "`echo "$1" | grep -wE "\-help|\-H"`" ] && usage 0
[ "`echo "$1" | grep -wE "\-version|\-V"`" ] && { echo "$0 -version $Version";exit 0; }
}  ###__old_header__(){  #END

  _TITLE_=pup_message
_COMMENT_="Replacement for 'xmessage'"

MY_SELF="$0"

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap
}

if [ ! "$1" ];then
 echo "Partial replacement for xmessage.
Can use only -bg -fg -timeout -title -center (default)
ex: pupmessage -bg '$ff8080' -title 'Title of popup' 'Body text here'
Note: use 'pupkill $!' to kill a pupmessage window."
exit 1
fi

#note: use 'pupkill $!' to kill a pupmessage window.

VALUEFLAG='no'; TITLETEXT=''; SEPPARAMS=''
for aFIELD in "${1}" "${2}" "${3}" "${4}" "${5}" "${6}" "${7}" "${8}" "${9}" "${10}" "${11}" "${12}" "${13}" "${14}" "${15}" TOOLONG
do
 [ "$aFIELD" = "" ] && break
 PREVFIELD="$aFIELD"
 [ "$aFIELD" = "TOOLONG" ] && exit 255
 case $VALUEFLAG in
  yes)
   SEPPARAMS="${SEPPARAMS} ${aFIELD}"
   VALUEFLAG='no'
   continue
  ;;
  title) #value can have multiple words.
   TITLETEXT="$aFIELD"
   VALUEFLAG='no'
   continue
  ;;
 esac
 ADDME='no'
 case "$aFIELD" in
  -title) VALUEFLAG='title'  ;;
  -bg|-fg|-buttons|-default|-file|-timeout) VALUEFLAG='yes'; ADDME='yes'  ;;
  -print|-center|-nearmouse) ADDME='yes' ;;
 esac
 [ "$ADDME" = "yes" ] && SEPPARAMS="${SEPPARAMS}
${aFIELD}"
done
SEPMSG="$PREVFIELD" #message to be displayed.

#if certain options, use original xmessage (or gxmessage)...
if [ "`echo "$SEPPARAMS" | grep -E '^-buttons|^-file|^-print|^-nearmouse|^-default'`" != "" ];then
 xSEPPARAMS=$(echo "$SEPPARAMS" | tr '\n' ' ')
 if [ "$TITLETEXT" ];then
  exec xmessage $xSEPPARAMS -title "$TITLETEXT" "$SEPMSG"
 else
  exec xmessage $xSEPPARAMS "$SEPMSG"
 fi
fi

xSEPPARAMS=$(echo "$SEPPARAMS" | sed -e 's%^-bg%--background%' -e 's%^-fg%--foreground%' -e 's%^-timeout%--timeout%' | sed '/^-center/d' | tr '\n' ' ')

#echo "xSEPPARAMS=${xSEPPARAMS}" #TEST

if [ "$TITLETEXT" ];then
 exec pupdialog $xSEPPARAMS --backtitle "$TITLETEXT" --msgbox "$SEPMSG" 0 0
else
 exec pupdialog $xSEPPARAMS --msgbox "$SEPMSG" 0 0
fi

###END###

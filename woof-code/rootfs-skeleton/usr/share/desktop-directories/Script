#!/bin/sh

for i in *.directory;do

ic=`grep -m1 '^Icon=.*' $i |cut -f2 -d=`

if [ "$ic" ];then

dn=${ic##*/}
echo $dn
if [ "$dn" = "$ic" ];then

icon=`find /usr \( -type f -o -type l \) -name "$ic" |head -n1`

if [ "$icon" ];then

sed -i "s,^Icon=.*,Icon=$icon," $i

fi #icon found
fi #dirname
fi #icon entry yes

done

#cleanup
for i in *.directory;
do
sed -i 's%/Backup/%/%' $i;
done

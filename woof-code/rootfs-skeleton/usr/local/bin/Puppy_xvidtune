#!/bin/ash
# The code in this script was former part of Xorgwizard .
# Took it out here to be able to run it without the need of closing the Xoegwizard GUI .

  _TITLE_=Puppy_xvidtune
_VERSION_=1.0omega
_COMMENT_="xmessage GUIs to select Display Hardware settings and adjustments by xvidtune tool."

MY_SELF="$0"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
 set +e
 source /etc/rc.d/f4puppy5 && {
 set +n
 source /etc/rc.d/f4puppy5; } || echo "WARNING : Could not source /etc/rc.d/f4puyppy5 ."

ADD_PARAMETER_LIST=
ADD_PARAMETERS=
_provide_basic_parameters

TWO_HELP=''; TWO_VERSION=''; TWO_VERBOSE=''; TWO_DEBUG=''; ## Set to anything if code requires further down (ie. custom usage or version message)
ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
for i in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap
} || echo "Warning : No /etc/rc.d/f4puppy5 installed."

( sleep 0.3;
   xmessage -bg violet -title "Xvidtune IMPORTANT HELP" "If you click the 'Show' button, the adjusted settings will be what
you want permanently. After hitting the 'Quit' button, you will be
given one last chance not to make the change permanent.
Thus:
'Show' to record the settings (for later inclusion into xorg.conf)
'Quit' to exit Xvidtune.

Please note that Xvidtune does not work with all video hardware, meaning
that changing the settings will cause no change on the screen." ) &
#   XMSGPID=$!

   MODELINE0=`xvidtune | grep '^"[0-9]'`
#   kill $XMSGPID

 pidXMESG=`ps | grep 'Xvidtune IMPORTANT HELP' | grep -v 'grep' | awk '{print $1}'`
 for aPID in $pidXMESG
 do
 /bin/ps -p $aPID && kill $aPID
 done

   if [ ! "$MODELINE0" = "" ];then
    xmessage -bg orange -title "Xvidtune: Modeline" -buttons Write:10,Quit:11 "The new modeline is:
 $MODELINE0

Note, you will have to restart X for it to take effect. If it messes
up X, edit from commandline 'mp /etc/X11/xorg.conf' and comment-out
the 'UseModes' line (do not delete it) in the Monitor section.

To insert this into /etc/X11/xorg.conf, click 'Write' button...
To exit without changing xorg.conf, click 'Quit' button..."
    if [ $? -eq 10 ];then

     aPATTERN="s/.*#modes0modeline0/ ModeLine $MODELINE0 #modes0modeline0/g"
     cat /etc/X11/xorg.conf | sed -e "$aPATTERN" >/tmp/xorg.conf.new
     sync
     cat /tmp/xorg.conf.new | sed -e 's/#.*UseModes/UseModes/g' >/etc/X11/xorg.conf
     sync
    fi
   fi

exit 0
# Very End of this file 'usr/sbin/Puppy_xvidtune' #
###END###

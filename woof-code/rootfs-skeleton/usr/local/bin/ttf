#!/bin/bash

# *****************************************************
# PROGRAM:	ttf v. 0.21 (part of pfont2)
# PURPOSE:	to display ttf font as png image
# AUTHOR:		vovchik (Puppy Linux forum)
# MODDED:		
# DEPENDS:	bash, ttf2png, convert or pngcrop, 
# 			gtkdialog3, gtkdialog-splash, which
# PLATFORM:	Puppy Linux (actually, any *nix)
# DATE:		20-06-2011
# NOTES:		If you have installed Pfont2 v. 0.21,
# 			you can define ttf as the default action
# 			for ttf files or customize rox so that
# 			you have a preview option on right click
# *****************************************************

# *********************
# INIT VARS
# *********************

msg_badfont="Pfont2 cannot display this font.
It must be pretty funky."
msg_nottf="Choose a real TTF font, please."
myfont="$@"
myresult=`ttf2png -s 32 -c 36 -a -l 16 -e "$myfont" -v -o /tmp/font.png`
myfile=`basename "$myfont"`
mysuffix=${myfile#*.}
mylow=$(echo $mysuffix |tr '[A-Z]' '[a-z]')

# *********************
# END INIT VARS
# *********************


# *********************
# MAIN
# *********************

if [[ "$mylow" == "ttf" ]]; then
	if [ -n "$myresult" ] ; then
		mysize=`echo "$myresult" | grep "Saved"`
		myheight=`echo "$mysize" | cut -d'x' -f2 | cut -d' ' -f1`
		myname=`echo "$myresult" | grep "Font name"`
		mytext=`echo "$myresult" | grep -v "Saved"`
		if which convert >/dev/null; then
			convert /tmp/font.png -trim /tmp/font1.png
		else
			case $myheight in
				128)
					myheight=110
				;;
				256)
					myheight=220
				;;
				*)
					myheight=512
				;;
			esac
			pngcrop /tmp/font.png 0 0 580 $myheight /tmp/font1.png
		fi
		gtkdialog-splash -deco "Pfont2 Preview: `basename $myfont` ($myname)" -close box -placement top-left -icon "/tmp/font1.png" -text "$mytext"
	else
		gtkdialog-splash -placement top -timeout 4 -fontsize medium -icon "gtk-dialog-error" -text "$msg_badfont"
	fi
else
	gtkdialog-splash -placement top -timeout 4 -fontsize medium -icon "gtk-dialog-error" -text "$msg_nottf"
fi
exit 0

# *********************
# END MAIN
# *********************
#!/bin/bash
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_defaultmediaplayer"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/local/bin/defaultmediaplayer"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in 1; do shift; done; }

_trap

}
# End new header
#

echo "$0: '$*'"

locale
locale | grep $QUIET -iE 'utf8|utf-8' || {
#export LANG=${LANG}.utf8
export LANG=${LANG}.UTF-8
export LC_ALL=$LANG
locale
exec $0 "$@"
}

#export LC_ALL=C
#export LANG=C

MEDIA_PLAYER=`which gxine`

while [ $# != 0 ]
do
[ "$VERBOSE" ] && echo "\$1='$1'"
case $1 in
-*)
[ "$PART_FILE" -a ! -e "$PART_FILE" ] && PART_FILE="$PART_FILE $1" || {
playerOPTIONS="$playerOPTIONS $1"
}
;;
*)
test -f "$*" && FILE="$*" || {
 case $1 in
  -[0-9A-Za-z]*)
   test "$PART_FILE" -a ! -e $"$PART_FILE $1" && PART_FILE="$PART_FILE $1" || {
   playerOPTIONS="$playerOPTIONS $1"
  }
  ;;
  *) [ "$PART_FILE" -a ! -e $"$PART_FILE" ] && PART_FILE="$PART_FILE $1" || PART_FILE="$1"
  ;;
 esac
}
;;
esac
shift
[ "$VERBOSE" ] && { echo "PART_FILE='$PART_FILE'
FILE='$FILE'"; }
done


if [ "$PART_FILE" ]; then
set -- $playerOPTIONS "$PART_FILE"
elif [ "$FILE" ]; then
set -- $playerOPTIONS "$FILE"
fi



[ "$PART_FILE" -a ! "$FILE" ] && echo "Have PART_FILE and not FILE"

[[ -e $"$PART_FILE" ]] && echo "PART_FILE exist"
[[ -e "$PART_FILE" ]] && echo "PART_FILE exist"
  [ -e "$PART_FILE" ] && echo "PART_FILE exist"
test -e "$PART_FILE" && echo "PART_FILE exist"


[[ -f $"$PART_FILE" ]] && echo "PART_FILE is file"
[[ -f "$PART_FILE" ]] && echo "PART_FILE is file"
  [ -f "$PART_FILE" ] && echo "PART_FILE is file"
test -f "$PART_FILE" && echo "PART_FILE is file"


#[[ "$PART_FILE" -a ! "$FILE" -a -e $"$PART_FILE" ]] && echo "Have PART_FILE and not FILE and exist PART_FILE"
[[ "$PART_FILE" ]] && [[ "$FILE" = "" ]] && [[ -e $"$PART_FILE" ]] && echo "Have PART_FILE and not FILE and exist PART_FILE"
#[[ "$PART_FILE" -a ! "$FILE" -a -e "$PART_FILE" ]] && echo "Have PART_FILE and not FILE and exist PART_FILE"
[[ "$PART_FILE" ]] && [[ "$FILE" = "" ]] && [[ -e "$PART_FILE" ]] && echo "Have PART_FILE and not FILE and exist PART_FILE"
  [ "$PART_FILE" -a ! "$FILE" -a -e "$PART_FILE" ] && echo "Have PART_FILE and not FILE and exist PART_FILE"
test "$PART_FILE" -a ! "$FILE" -a -e "$PART_FILE" && echo "Have PART_FILE and not FILE and exist PART_FILE"


#[[ "$PART_FILE" -a ! "$FILE" -a -e $"$PART_FILE" ]] && FILE="$PART_FILE"
echo "PART_FILE='$PART_FILE'
FILE='$FILE'"

if test -f "$FILE"; then
case "$FILE" in
*.mp4) MEDIA_PLAYER=`which gnome-mplayer`;;
*.flv|*.swf) MEDIA_PLAYER=`which gnome-mplayer`;;
*.mp3) :;;
*) FILETYPE=`file "$FILE"`
   case "$FILETYPE" in
   *flash*|*Flash*|*FLASH*|*MP4*|*Mp4*|*mp4*|*MPEG*v4*) MEDIA_PLAYER=`which gnome-mplayer`;;
   esac;;
esac
fi

which "$MEDIA_PLAYER" || exit 1

#echo "'$MEDIA_PLAYER' '$playerOPTIONS' '$@'" >&2
#exec "$MEDIA_PLAYER" $playerOPTIONS "$@"

echo "'$MEDIA_PLAYER' '$playerOPTIONS' '$@'" >&2
exec "$MEDIA_PLAYER" "$@"

#echo "'$MEDIA_PLAYER' '$playerOPTIONS' '$FILE'" >&2
#exec "$MEDIA_PLAYER" $playerOPTIONS "$FILE"

# Very End of this file 'usr/local/bin/defaultmediaplayer' #
###END###

#!/bin/sh
#
###################
#
# trayInsert
#  for use with jwmConfigMgr
# Allows user to specify
#  'left' or 'right' as the
#  side for insertion of new
#  programs into the JWM tray
#
# Author: thoughtjourney
# Date: 27/08/2005
#
# Code updated for Puppy 1.0.9, JWM 1.7
# by Kwiller on 6-May-2006
#
###################

##-----taskbarConfig----->>
PRO="trayInsert"
SCRIPT_DIR="/usr/local/jwmconfig3"
. "$SCRIPT_DIR/path"
. /etc/rc.d/f4puppy5

#-----Backup current settings----->>
. "$SCRIPT_DIR/func" -backup2

#----Check for current settings---->>
SET_LEFT=`grep -c "$DCL" "$personalFILE"`
SET_RIGHT=`grep -c "$DCR" "$personalFILE"`
SET_ON=`grep -c "$DCO" "$personalFILE"`

#----Set Default Settings---->>
LEFT_ON=off
RIGHT_ON=ON
SEDLEFT=s!insert=\".*\"!insert=\"left\"!g
SEDRIGHT=s!insert=\".*\"!insert=\"right\"!g

#----Determine if Current Setting non-default----->>
if [ "$SET_LEFT" -eq "1" ]; then
    LEFT_ON=ON
    RIGHT_ON=off
fi
##--end defaults--->

#-------------gui----------->>

Xdialog --backtitle "JWM Taskbar Configuration" \
    --title "Tray Insertion Option" \
        --radiolist "Choose which side new programs will enter the tray" 13 46 2 \
"LEFT"  "New programs enter at left." $LEFT_ON \
"RIGHT" "New programs enter at right." $RIGHT_ON 2>"$tmpCL"
retval=$?

#--------cancel pressed----->>
. "$SCRIPT_DIR/func" -cancel

#---------save changes----->>

SIDE=`tail -n1 "$tmpCL"`

if [ "$SET_ON" -eq "1" ]
then
#-----If there are current settings change them----->>
   if [ "$SIDE" = "RIGHT" ]; then
      sed -e "$SEDRIGHT" "$personalFILE" > "$personalFILEtmp"
   else
      sed -e "$SEDLEFT" "$personalFILE"  > "$personalFILEtmp"
   fi
   SED_RV=$?
else
#-----If there are no current settings add the new one---->>

  echo "  " >"$tmpCL"
  echo '<!-- Tray Task Insert -->'           >>"$tmpCL"

  if [ "$SIDE" = "RIGHT" ]; then
    echo "<TaskListStyle insert=\"right\"/>" >>"$tmpCL"
  else
    echo "<TaskListStyle insert=\"left\"/>"  >>"$tmpCL"
  fi

  sed -e "/<JWM>/r $tmpCL" "$personalFILE" >"$personalFILEtmp"
  SED_RV=$?
fi

mv "$personalFILEtmp" "$personalFILE"

#------check new configuration----->>
. "$SCRIPT_DIR/func" -checkconf

#----notify of result----->>
if [ "$SIDE" = "RIGHT" ]; then
  RES=`grep -c "<TaskListStyle insert=\"right\"/>" "$personalFILE"`
else
  RES=`grep -c "<TaskListStyle insert=\"left\"/>" "$personalFILE"`
fi
echo $DEB $PRO 96 '$RES' $RES
CHOICE=$SIDE
PATTERN=" insert"
PF=1

. "$SCRIPT_DIR/func" -notify

#--------clean exit------->>
rm -f "$tmpCL"
exit 0
# Very End of this file 'usr/local/jwmconfig3/trayInsert' #
###END###

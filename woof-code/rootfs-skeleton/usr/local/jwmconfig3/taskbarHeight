#!/bin/ash
#
# Code adapted for Puppy 1.0.9, JWM 1.7
# by Kwiller on 07-May-2006
#
###################
#v3.99 normal height now 28, changed from 26. changed short 18 -> 20.

##-----taskbarHeight----->>
PRO="taskbarHeight"
SCRIPT_DIR="/usr/local/jwmconfig3"
test -f "$SCRIPT_DIR/variables" && . "$SCRIPT_DIR/variables"
. /etc/rc.d/f4puppy5

DEBUG=1

# jwm -reload does not work here ..?
#jwmVERSION=`jwm -v 2>/dev/null | head -n1 | grep -oe '[[:digit:]]\+'`
#[ "$jwmVERSION" ] || jwmVERSION=547

#-----Backup current settings----->>
. "$SCRIPT_DIR/func" -backup2

#----Set defaults---->>
IS_SHRT=off
IS_NORM=ON
IS_TALL=off
IS_XTTL=off
CRHT="NORMAL"

#----Are current settings non-default---->>
SET_TALL=`grep -c "height=\"$TALL\"" "$trayFILE"`

if [ "$SET_TALL" -eq "1" ]; then
    IS_SHRT=off
    IS_NORM=off
    IS_TALL=ON
    IS_XTTL=off
    CRHT="TALL"
else
    SET_SHRT=`grep -c "height=\"$SHRT\"" "$trayFILE"`

    if [ "$SET_SHRT" -eq "1" ]; then
        IS_SHRT=ON
        IS_NORM=off
        IS_TALL=off
        IS_XTTL=off
        CRHT="SHORT"
    else
        SET_XTTL=`grep -c "height=\"$XTTL\"" "$trayFILE"`

        if [ "$SET_XTTL" -eq "1" ]; then
            IS_SHRT=off
            IS_NORM=off
            IS_TALL=off
            IS_XTTL=ON
            CRHT="TALLER"
        fi
    fi
fi

SEDSHRT=s!height=\".*\"!height=\"$SHRT\"!g
SEDNORM=s!height=\".*\"!height=\"$NORM\"!g
SEDTALL=s!height=\".*\"!height=\"$TALL\"!g
SEDXTTL=s!height=\".*\"!height=\"$XTTL\"!g

#-------------gui----------->>

Xdialog --backtitle "JWM Taskbar Configuration" \
    --title "Taskbar" \
        --radiolist "Choose a tray height option" 18 46 4 \
"SHORT"  "About 70% of Normal." $IS_SHRT \
"NORMAL"  "The default height" $IS_NORM \
"TALL"  "About 130% of Normal." $IS_TALL \
"TALLER"  "About 160% of normal" $IS_XTTL 2>"$tmpCL"

retval=$?

#--------cancel pressed----->>
. "$SCRIPT_DIR/func" -cancel

#---------save changes----->>

HGHT=`tail -n1 "$tmpCL"`
_debug "HGHT='$HGHT'"

#-----If there are new settings chosen then make the changes----->>
if [ "$HGHT" != "$CRHT" ]; then
  case $HGHT in
     "SHORT") sed -e "$SEDSHRT" "$trayFILE" > "$trayFILEtmp"
                SED_RV=$?
              ;;
    "NORMAL") sed -e "$SEDNORM" "$trayFILE" > "$trayFILEtmp"
                SED_RV=$?
              ;;
      "TALL") sed -e "$SEDTALL" "$trayFILE" > "$trayFILEtmp"
                SED_RV=$?
              ;;
    "TALLER") sed -e "$SEDXTTL" "$trayFILE" > "$trayFILEtmp"
                SED_RV=$?
              ;;
  esac
  mv $VERB "$trayFILEtmp" "$trayFILE"
_debug "SED_RV='$SED_RV'"
fi

#------check new configuration----->>
. "$SCRIPT_DIR/func" -checkconf
_debug "CHECKCONF='$CHECKCONF'"

#----notify of result----->>
case $HGHT in
     "SHORT") RES=`grep -c "height=\"$SHRT\"" "$trayFILE"`
              [ "$DEBUG" ] && grep  "height=\"$SHRT\"" "$trayFILE" >&2
              ;;
    "NORMAL") RES=`grep -c "height=\"$NORM\"" "$trayFILE"`
              [ "$DEBUG" ] && grep  "height=\"$NORM\"" "$trayFILE" >&2
              ;;
      "TALL") RES=`grep -c "height=\"$TALL\"" "$trayFILE"`
              [ "$DEBUG" ] && grep  "height=\"$TALL\"" "$trayFILE" >&2
              ;;
    "TALLER") RES=`grep -c "height=\"$XTTL\"" "$trayFILE"`
              [ "$DEBUG" ] && grep  "height=\"$XTTL\"" "$trayFILE" >&2
              ;;
esac
_debug "RES='$RES'"

CHOICE=$HGHT
PATTERN="Panel"
PF=0
. "$SCRIPT_DIR/func" -notify

if test "$RETURN" = 0; then
 echo 'ICONWIPE' > /tmp/pup_event_icon_change_flag
 #--------clean exit------->>
 [ "$DEBUG" ] || rm $VERB -f "$tmpCL"
 # jwm -reload does not work here ..?
 #test "$jwmVERSION" -ge 547 && jwm -reload
 exit 0
else
 exit $RETURN
fi

# Very End of this file 'usr/local/jwmconfig3/taskbarHeight' #
###END###

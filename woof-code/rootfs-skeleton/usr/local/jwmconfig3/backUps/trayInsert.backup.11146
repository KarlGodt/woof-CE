#!/bin/sh
#
###################
#
# trayInsert
# for use with jwmConfigMgr
# Allows user to specify
# 'left' or 'right' as the
# side for insertion of new
# programs into the JWM tray
#
# author: thoughtjourney
# date: 27/08/2005
#
# Code updated for Puppy 1.0.9, JWM 1.7
# by Kwiller on 6-May-2006
#
###################

##-----taskbarConfig----->>
PRO="/trayInsert"
SCRIPT_DIR="/usr/local/jwmconfig3"
. $SCRIPT_DIR/path


#-----Backup current settings----->>
. $SCRIPT_DIR/func -backup2

#----Check for current settings---->>
SET_LEFT=`grep -c "$DCL" $PersonalFile`
SET_RIGHT=`grep -c "$DCR" $PersonalFile`
SET_ON=`grep -c "$DCO" $PersonalFile`

#----Set Default Settings---->>
LEFT_ON=off
RIGHT_ON=ON
SEDLEFT=s!insert=\".*\"!insert=\"left\"!g
SEDRIGHT=s!insert=\".*\"!insert=\"right\"!g

#----Determine if Current Setting non-default----->>
if [ "$SET_LEFT" -eq "1" ]; then
    LEFT_ON=ON
    RIGHT_ON=off
fi
##--end defaults--->

#-------------gui----------->>

Xdialog --backtitle "JWM Taskbar Configuration" \
	--title "Tray Insertion Option" \
        --radiolist "Choose which side new programs will enter the tray" 13 46 2 \
"LEFT"  "New programs enter at left." $LEFT_ON \
"RIGHT" "New programs enter at right." $RIGHT_ON 2>$TmpCL
retval=$?

#--------cancel pressed----->>
. $SCRIPT_DIR/func -cancel

#---------save changes----->>

SIDE=`cat $TmpCL`

if [ "$SET_ON" -eq "1" ]
then
#-----If there are current settings change them----->>
   if [ "$SIDE" = "RIGHT" ]; then
      sed -e "$SEDRIGHT" $PersonalFile > $PersonalFileTmp
   else
      sed -e "$SEDLEFT" $PersonalFile > $PersonalFileTmp
   fi
else
#-----If there are no current settings add the new one---->>

  echo "  " > $TmpCL
  echo '<!-- Tray Task Insert -->' >> $TmpCL
  
  if [ "$SIDE" = "RIGHT" ]; then
    echo "<TaskListStyle insert=\"right\"/>" >> $TmpCL
  else
    echo "<TaskListStyle insert=\"left\"/>" >> $TmpCL
  fi

  sed -e "/<JWM>/r $TmpCL" $PersonalFile > $PersonalFileTmp

fi

mv $PersonalFileTmp $PersonalFile

#------check new configuration----->>
. $SCRIPT_DIR/func -checkconf

#----notify of result----->>
if [ "$SIDE" = "RIGHT" ]; then
  RES=`grep -c "<TaskListStyle insert=\"right\"/>" $PersonalFile`
else
  RES=`grep -c "<TaskListStyle insert=\"left\"/>" $PersonalFile`
fi
echo $DEB $PRO 96 '$RES' $RES
CHOICE=$SIDE
PATTERN=" insert"
PF=1

. $SCRIPT_DIR/func -notify

#--------clean exit------->>
rm -f $TmpCL
exit 0

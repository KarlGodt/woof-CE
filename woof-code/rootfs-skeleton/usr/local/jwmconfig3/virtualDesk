#!/bin/bash
#
# Code updated for Puppy 1.0.9, JWM 1.7
# by Kwiller on 5-May-2006
#

##-----DesktopCount Config----->>
PRO="virtualDesk"
SCRIPT_DIR="/usr/local/jwmconfig3"
. "$SCRIPT_DIR/path"
. /etc/rc.d/f4puppy5

#-----Backup current settings----->>
. "$SCRIPT_DIR/func" -backup2

#----Check for current settings---->>
SET_ON=`grep -c "$DC" "$personalFILE"`

#----Set choice outside of range----->>
CHOICE=0

#----------dialogue-------->>

#--- loop until choice is in range 1 to 8 ---->>
while [ "$CHOICE" -lt "$MINTOPS" -o "$CHOICE" -gt "$MAXTOPS" ]
do
  Xdialog --title "Virtual Desktops" \
          --inputbox "Specify your desired number of virtual desktops (1 - 8)" 0 0 2>"$tmpIB"

  retval=$?

#--------cancel pressed------->>
. "$SCRIPT_DIR/func" -cancel

#-------preparation----------->>

  CHOICE=`cat $tmpIB`

  if [ -z $CHOICE ]; then
     CHOICE=1
  fi
done

if [ "$SET_ON" -eq "1" ]
then
#-----If there are current settings change them----->>

  SEDCOUNT=s!count=\"[0-9][0-9]*\"!count=\"${CHOICE}\"!g

  sed -e "$SEDCOUNT" "$personalFILE" > "$personalFILEtmp"
  SED_RV=$?
else
#-----If there are no current settings add the new one---->>

  echo "  " >"$tmpIB"
  echo '<!-- Number of virtual desktops -->' >>"$tmpIB"
  echo "<Desktops count=\"${CHOICE}\"/>"     >>"$tmpIB"

  sed -e "/<JWM>/r $tmpIB" "$personalFILE" >"$personalFILEtmp"
  SED_RV=$?
fi

#---------save changes----->>
mv "$personalFILEtmp" "$personalFILE"

#------check new configuration----->>
. "$SCRIPT_DIR/func" -checkconf

#----notify of result----->>
RES=`grep -c "Desktops count=\"$CHOICE\"/>" "$personalFILE"`
PATTERN="virtual desktops"
PF=1
. "$SCRIPT_DIR/func" -notify

#--------clean exit------->>
rm -f "$tmpIB"
exit 0

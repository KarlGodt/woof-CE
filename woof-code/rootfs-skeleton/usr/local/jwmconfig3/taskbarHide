#!/bin/bash
#
# Code adapted for Puppy 1.0.9, JWM 1.7
# by Kwiller on 6-May-2006
#
###################

##-----taskbarPlace----->>
PRO="taskbarConfig"
SCRIPT_DIR="/usr/local/jwmconfig3"
. $SCRIPT_DIR/path


#-----Backup current settings----->>
. $SCRIPT_DIR/func -backup2

#----Set defaults---->>
AUTO_OFF=ON
AUTO_SET=off

#----Are current settings non-default---->>
SET_AHD=`grep -c "autohide=\"$ISSET\"" $trayFILE`

if [ "$SET_AHD" -eq "1" ]; then
    AUTO_OFF=off
    AUTO_SET=ON
fi
SEDSET=s!autohide=\"$ISOFF\"!autohide=\"$ISSET\"!g
SEDOFF=s!autohide=\"$ISSET\"!autohide=\"$ISOFF\"!g
##---end defaults--->

#-------------gui----------->>

Xdialog --backtitle "JWM Taskbar Configuration" \
    --title "Taskbar" \
        --radiolist "Choose a tray autohide option" 13 46 2 \
"OFF"  "Tray Autohide off." $AUTO_OFF \
"ON"    "Tray Autohide on" $AUTO_SET 2>$tmpCL

retval=$?

#--------cancel pressed----->>
. $SCRIPT_DIR/func -cancel

#---------save changes----->>

OPTN=`cat $tmpCL`

#-----If there new settings chosen then make the changes----->>
if [ "$OPTN" = "ON" ]; then
  if [ "$SET_AHD" -eq "0" ]; then
    sed -e "$SEDSET" $trayFILE >$trayFILEtmp
    SED_RV=$?
    mv $trayFILEtmp $trayFILE
  fi
else
  if [ "$SET_AHD" -eq "1" ]; then
    sed -e "$SEDOFF" $trayFILE >$trayFILEtmp
    SED_RV=$?
    mv $trayFILEtmp $trayFILE
  fi
fi

#------check new configuration----->>
. $SCRIPT_DIR/func -checkconf

#----notify of result----->>
if [ "$OPTN" = "ON" ]; then
  RES=`grep -c "autohide=\"$ISSET\"" $trayFILE`
else
  RES=`grep -c "autohide=\"$ISOFF\"" $trayFILE`
fi

CHOICE=$OPTN
PATTERN=" to autohide"
. $SCRIPT_DIR/func -notify

#--------clean exit------->>
rm -f $tmpCL
exit 0

#!/bin/bash

#built top 100 menuitems for jamendo
TOP100_MENU=''
for I in ' ' Blues Classical Electro Jazz Hiphop Lounge Metal Pop Rock; do
  TOP100_MENU=$TOP100_MENU'<menuitem label="Top 100 '$I'">
   <action>'$APPDIR'/func_webmusic -jamendo_top100 '$I' &</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>'
done
#---

S='
<menu label="'$LOC100'">
 <menuitem stock="gtk-new" label="'$LOC111'" accel-key="0x06e" accel-mods="4">
  <action>'$APPDIR'/func_store_playlist</action>
  <action>'$APPDIR'/func -new</action>
  <action>refresh:PLAYLIST</action>
 </menuitem>'
 #when using an external source window (Classic)
 [ "`echo $$ grep -w '-open'`" ] && S=$S'<menuitem stock="gtk-open" accel-key="0x06f" accel-mods="4">
  <label>'$LOC101'...</label>
  <action>show_sources_window</action>
 </menuitem>'
 #---
 S=$S'<menuitem stock="gtk-cdrom" label="'$LOC105'">'
  [ "$CD_DEV" = false ] && S=$S'<visible>disabled</visible>'
  S=$S'<action>'$APPDIR'/func_cd -play_cd</action>
  <action>refresh:PLAYLIST</action>
 </menuitem>
 <menuitem stock="gtk-save" label="'$LOC102'" accel-key="0x073" accel-mods="4"><action>. '$APPDIR'/func -save</action></menuitem>
 <menuitemseparator></menuitemseparator>
 <menuitem stock="gtk-preferences" label="'$LOC103'"><action>'$APPDIR'/func_config -preferences &</action></menuitem>
 <menuitem label="'$LOC104'"><action>'$APPDIR'/func_index -update_index &</action></menuitem>
 <menuitem label="'$LOC106'"><action>. '$APPDIR'/func_radio &</action></menuitem>
 <menuitem label="'$LOC1010'"><action>'$APPDIR'/func_webmusic -webmusic_manager &</action></menuitem>
 <menuitem label="'$LOC107'"><action>. '$APPDIR'/func_podcast &</action></menuitem>
 <menuitem label="'$LOC109'"><action>. '$APPDIR'/func_bookmarks -manage_bookmarks &</action></menuitem>
 <menuitemseparator></menuitemseparator>
 <menuitem label="'$LOC_EQUALIZER'">
  <label>'$LOC_EQUALIZER'...</label>
  '
  ! type pequalizer > /dev/null 2>&1 && S=$S' 
  <visible>disabled</visible>
  '
 S=$S'<action>'$APPDIR'/func -reset_gtk</action>
  <action>pequalizer &</action>
 </menuitem>
 <menuitemseparator></menuitemseparator>
 <menuitem stock="gtk-cdrom" label="'$LOC108'">'
  [ "$CD_DEV" = false ] && S=$S'<visible>disabled</visible>'
  S=$S'<action>eject</action>
 </menuitem>
 <menuitem stock="gtk-quit" label="'$LOC_QUIT'" accel-key="0x071" accel-mods="4">
  <action>'$APPDIR'/func -write_config</action>
  <action>EXIT:quit</action>
 </menuitem>
</menu>'
GUI_MENU_FILE="$S"

S='
 <menuitem stock="gtk-about" label="'$LOC172'">
  <action>. '$APPDIR'/func -show_add_window -source</action>
  <action>clear:SOURCE</action>
  <action>refresh:SOURCE</action>
 </menuitem>
 <menuitemseparator></menuitemseparator>
 <menuitem label="CD">'
  [ "$CD_DEV" = false ] && S=$S'<visible>disabled</visible>'
  S=$S'<action>echo "|'$LOC708'" > '$WORKDIR'/browser</action>
  <action>'$APPDIR'/func_cd -read_cd &</action>
  <action>clear:SOURCE</action>
  <action>refresh:SOURCE</action>
 </menuitem>
 <menu label="'$LOC238'">
  <menuitem label="'$LOC_BROWSE'">
   <action>export SOURCE="  '$BROWSERDIR'"; . '$APPDIR'/func -browse</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
  <menuitem label="'$LOC_SEARCH'"><action>'$APPDIR'/func -pfilesearch</action></menuitem>
 </menu>
 <menu label="'$LOC228'">
  <menuitem label="'$LOC223'">
   <action>. '$APPDIR'/func -index_songs</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
  <menuitem label="'$LOC224'">
   <action>. '$APPDIR'/func -index_playlists</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
 </menu>
 <menu label="'$LOC222'">
  <menuitem label="'$LOC_GENRE'">
   <action>. '$APPDIR'/func -radio -genre</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
  <menuitem label="'$LOC_COUNTRY'">
   <action>. '$APPDIR'/func -radio -country</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
 </menu>

##Webmusic
 <menu label="'$LOC221'">
  '$TOP100_MENU'
  <menuitemseparator></menuitemseparator>
  <menuitem label="'$LOC_BROWSE'">
   <action>'$APPDIR'/func_webmusic -webmusic &</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
 </menu>
 <menuitem label="'$LOC600'">
  <action>if [ ! "`find "'$PODCAST_DIR'" -mindepth 1`" ]; then echo "|'$LOC617'" > '$WORKDIR'/sourcelist; else SOURCE="  '$PODCAST_DIR'"; . '$APPDIR'/func -browse; fi</action>
  <action>clear:SOURCE</action>
  <action>refresh:SOURCE</action>
 </menuitem>
 <menuitem label="'$LOC227'">
  <action>. '$APPDIR'/func_bookmarks -show_bookmarks</action>
  <action>clear:SOURCE</action>
  <action>refresh:SOURCE</action>
 </menuitem>
 <menuitemseparator></menuitemseparator>
 <menuitem label="'$LOC225'">
  <action>. '$APPDIR'/func -index_recent</action>
  <action>clear:SOURCE</action>
  <action>refresh:SOURCE</action>
 </menuitem>
 <menuitem label="'$LOC226'">
  <action>. '$APPDIR'/func -index_rating</action>
  <action>clear:SOURCE</action>
  <action>refresh:SOURCE</action>
 </menuitem>'
GUI_MENU_SOURCES_MAIN="$S"

GUI_MENU_SOURCES_LIST='
 <menuitem label="'$LOC240'"><action>'$APPDIR'/func_bookmarks -manage_bookmarks</action></menuitem>
 <menuitem label="'$LOC116'"><action>export LIST='$WORKDIR'/sourcelist; '$APPDIR'/func_id3tagger</action></menuitem>
 <menuitemseparator></menuitemseparator>
 <menuitem stock="gtk-sort-ascending" label="'$LOC233' '$LOC236' '$LOC237'">
  <action>'$APPDIR'/func -index_sort_file</action>
  <action>clear:SOURCE</action>
  <action>refresh:SOURCE</action>
 </menuitem>
 
 ##sort submenu
 <menu stock="gtk-sort-ascending" label="'$LOC233' '$LOC236' '$LOC840'">
  <menuitem label="'$LOC233' '$LOC236' '$LOC_TITLE'">
   <action>'$APPDIR'/func -index_sort_title</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
  <menuitem stock="gtk-sort-ascending" label="'$LOC233' '$LOC236' '$LOC_ARTIST'">
   <action>'$APPDIR'/func -index_sort_artist</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
  <menuitem label="'$LOC233' '$LOC236' '$LOC_ALBUM'">
   <action>'$APPDIR'/func -index_sort_album</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
  <menuitem label="'$LOC233' '$LOC236' '$LOC_TRACK'">
   <action>'$APPDIR'/func -index_sort_track</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
  <menuitem label="'$LOC233' '$LOC236' '$LOC_YEAR'">
   <action>'$APPDIR'/func -index_sort_year</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
  <menuitem label="'$LOC233' '$LOC236' '$LOC_GENRE'">
   <action>'$APPDIR'/func -index_sort_genre</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
  <menuitem label="'$LOC233' '$LOC236' '$LOC294'">
   <action>'$APPDIR'/func -index_sort_bitrate</action>
   <action>clear:SOURCE</action>
   <action>refresh:SOURCE</action>
  </menuitem>
 </menu>
 ##---

 <menuitemseparator></menuitemseparator>
 <menuitem stock="gtk-add" label="'$LOC232'">
  <action>'$APPDIR'/func_add -add_random</action>
  <action>refresh:PLAYLIST</action>
 </menuitem>
 <menuitem stock="gtk-add" label="'$LOC230'">
  <action>'$APPDIR'/func_add -add_all</action>
  <action>refresh:PLAYLIST</action>
 </menuitem>
'

GUI_MENU_SOURCES='
<menu label="'$LOC170'">
 '$GUI_MENU_SOURCES_MAIN'
 <menuitemseparator></menuitemseparator>
 '$GUI_MENU_SOURCES_LIST'
</menu>'

S='
<menu label="'$LOC110'">
 <menuitem stock="gtk-convert" label="'$LOC114'..."><action>'$APPDIR'/func_export &</action></menuitem>
 <menuitem stock="gtk-cdrom" label="'$LOC115'">'
  if [ ! -f /usr/local/pburn/pburn ] || [ "$CD_DEV" = false ]; then S=$S'<visible>disabled</visible>'; fi
  S=$S'<action>'$APPDIR'/func -burn &</action>
 </menuitem>
 <menuitem label="'$LOC116'..."><action>export LIST='$WORKDIR'/playlist; '$APPDIR'/func_id3tagger</action></menuitem>
 <menuitemseparator></menuitemseparator>'
 #find active playlist
RADIO1=false; RADIO2=false; RADIO3=false; RADIO4=false
case "$(<$WORKDIR/PLAYLIST1234)" in
	1) RADIO1=true;;
	2) RADIO2=true;;
	3) RADIO3=true;;
	4) RADIO4=true;;
esac
 S=$S'<menuitem radiobutton="'$RADIO1'" accel-key="0x031" accel-mods="4">
  <label>'$PLAYLIST1_NAME'</label>
  <action>if true '$APPDIR'/func -store_playlist1234; echo 1 > '$WORKDIR'/PLAYLIST1234; cp '$WORKDIR'/playlist1 '$WORKDIR'/playlist; '$APPDIR'/func -statusbar_playlist</action>
  <action>refresh:PLAYLIST</action>
 </menuitem>
 <menuitem radiobutton="'$RADIO2'" accel-key="0x032" accel-mods="4">
  <label>'$PLAYLIST2_NAME'</label>
  <action>if true '$APPDIR'/func -store_playlist1234; echo 2 > '$WORKDIR'/PLAYLIST1234; cp '$WORKDIR'/playlist2 '$WORKDIR'/playlist; '$APPDIR'/func -statusbar_playlist</action>
  <action>refresh:PLAYLIST</action>
 </menuitem>
 <menuitem radiobutton="'$RADIO3'" accel-key="0x033" accel-mods="4">
  <label>'$PLAYLIST3_NAME'</label>
  <action>if true '$APPDIR'/func -store_playlist1234; echo 3 > '$WORKDIR'/PLAYLIST1234; cp '$WORKDIR'/playlist3 '$WORKDIR'/playlist; '$APPDIR'/func -statusbar_playlist</action>
  <action>refresh:PLAYLIST</action>
 </menuitem>
 <menuitem radiobutton="'$RADIO4'" accel-key="0x034" accel-mods="4">
  <label>'$PLAYLIST4_NAME'</label>
  <action>if true '$APPDIR'/func -store_playlist1234; echo 4 > '$WORKDIR'/PLAYLIST1234; cp '$WORKDIR'/playlist4 '$WORKDIR'/playlist; '$APPDIR'/func -statusbar_playlist</action>
  <action>refresh:PLAYLIST</action>
 </menuitem>
 <menuitem stock="gtk-edit"label="'$LOC137'"><action>'$APPDIR'/func_config -preferences -playlist &</action></menuitem>
 <menuitemseparator></menuitemseparator>
 <menuitem stock="gtk-undo" label="'$LOC118'" accel-key="0x07a" accel-mods="4">
  <action>. '$APPDIR'/func -undo</action>
  <action>refresh:PLAYLIST</action>
 </menuitem>
 <menuitem stock="gtk-redo"label="'$LOC119'" accel-key="0x079" accel-mods="4">
  <action>. '$APPDIR'/func -redo</action>
  <action>refresh:PLAYLIST</action>
 </menuitem>
</menu>'
GUI_MENU_PLAYLIST="$S"

GUI_MENU_TRACK='
<menu label="'$LOC140'">
 <menuitem label="'$LOC142'" accel-key="0x062" accel-mods="4"><action>'$APPDIR'/func_bookmarks -manage_bookmarks -add_playing &</action></menuitem>
 <menuitem label="'$LOC141'" stock="gtk-info" accel-key="0x069" accel-mods="4"><action>'$APPDIR'/func_trackinfo &</action></menuitem>
 <menuitemseparator></menuitemseparator>
 <menuitem stock="gtk-media-play" label="'$LOC_PLAY' / '$LOC151'" accel-key="0x020" accel-mods="8"><action>'$APPDIR'/func_player -play</action></menuitem>
 <menuitem stock="gtk-media-next" label="'$LOC153'" accel-key="0xff53" accel-mods="8"><label>'$LOC153'</label><action>cp -f '$WORKDIR'/PLAYLIST '$WORKDIR'/tmpPLAYLIST</action><action>'$APPDIR'/func_player -next</action></menuitem>
 <menuitem stock="gtk-media-previous" label="'$LOC154'" accel-key="0xff51" accel-mods="8"><action>'$APPDIR'/func_player -back</action></menuitem>
 <menuitem label="'$LOC155'"><action>'$APPDIR'/func_player -jump_to</action></menuitem>
</menu>'

ITEMS=`ls "$APPDIR"/presets | awk '{print "<menuitem><label>"$1"</label><action>. $APPDIR/func -update_playlist</action><action>pmusic -p "$1"</action></menuitem>"}'`
GUI_MENU_VIEW='
<menu>
 <menuitem icon="gtk-fullscreen">
  <label>'$LOC181'...</label>
  <action>. '$APPDIR'/func -update_playlist</action>
  <action>pmusic -j -p .NowPlaying</action>
 </menuitem>
 <menuitemseparator></menuitemseparator>
 '$ITEMS'
 <label>'$LOC180'</label>
</menu>'

GUI_MENU_HELP='
<menu label="'$LOC190'">
 <menuitem stock="gtk-about" label="'$LOC191'"><action>'$APPDIR'/func -about &</action></menuitem>
 <menuitem stock="gtk-help" label="'$LOC192'" accel-key="0xffbe" accel-mods="0"><action>'$APPDIR'/func -faq &</action></menuitem>
 <menuitemseparator></menuitemseparator>
 <menuitem label="'$LOC195'"><action>rxvt --hold +sb -bg black -fg grey -cr black -geometry 57x21 -title "Pmusic - '$LOC195'" -e pmusic -D &</action></menuitem>
</menu>'

GUI_MENU="
<menubar>
 $GUI_MENU_FILE
 $GUI_MENU_SOURCES
 $GUI_MENU_PLAYLIST
 $GUI_MENU_TRACK
 $GUI_MENU_VIEW
 $GUI_MENU_HELP
</menubar>"

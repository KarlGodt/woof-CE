#!/bin/bash
. $CONFIG #to get correct Preset to return to

set -a
. $APPDIR/gui_misc

#geometry
HEIGHT=`xwininfo -root | grep -m 1 '\geometry' | cut -f4 -d ' ' | cut -f2 -d 'x' | cut -f1 -d '+'`
WIDTH=`xwininfo -root | grep -m 1 '\geometry' | cut -f4 -d ' ' | cut -f1 -d 'x'`
#gtk-theme
echo 'style "fullscreen" { font_name="bold 14" bg[NORMAL]="black" base[NORMAL]="black" fg[NORMAL]="grey40" text[NORMAL]="grey40" }
widget "*" style "fullscreen"' > $WORKDIR/gtkrc2
export GTK2_RC_FILES=$WORKDIR/gtkrc2

GUI='
<window title="Pmusic" icon-name="gtk-media-stop" default_height="'$HEIGHT'" default_width="'$WIDTH'" decorated="false" resizeable="false">
 <vbox space-expand="true" space-fill="true">
  <hbox>
   <vbox space-expand="false" space-fill="false">
    <text height-request="20"><label>""</label></text>
    <button can-focus="no">
     <input file stock="gtk-leave-fullscreen"></input>
     <action>pmusic -p '$PMUSIC_PRESET'</action>
    </button>
   </vbox>
   <text width-request="20"><label>""</label></text>
  </hbox>
 <vbox>
   <hbox homogeneous="true">
    <vbox space-expand="false" space-fill="false">
     <pixmap>
      <variable>ARTWORK</variable>
      <height>400</height>
      <input file>'$HOME'/.pmusic/nowplaying_albumart.jpg</input>
     </pixmap>
     <text height-request="25">
      <variable>NOWPLAYING</variable>
      <input>cut -d"|" -f1 '$HOME'/.pmusic/nowplaying</input>
     </text>
     '$GUI_PROGRESSBAR'
    </vbox>
   </hbox>
 </vbox>
 </vbox>
</window>'

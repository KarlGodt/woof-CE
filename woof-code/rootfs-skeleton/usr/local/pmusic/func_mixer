#! /bin/bash
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_func_mixer"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/local/pmusic/func_mixer"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
[ "$HAVE_F4PUPPY5" ] || source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

TWO_HELP=''; TWO_VERSION=''; TWO_VERBOSE=''; TWO_DEBUG=''; ## Set to anything if code requires further down (ie. custom usage or version message)
ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap

}
# End new header
#
IFS=$'\n'
[ ! "$SPEAKER" ] && . $HOME/.pmusic/pmusicrc

case $1 in
-gui)
	. $APPDIR/gui_mixer
	export Pmusic_mixer="
	<window title=\"Pmusic $LOC148\" icon-name=\"gtk-media-stop\">
	 <vbox>
	  $GUI_MIXER
	 </vbox>
	</window>"
	 $GTKDIALOG --program=Pmusic_mixer
	;;
-mute)
	if [ `cat $WORKDIR/func_mixer-MUTE` = true ]; then
		amixer set "$SPEAKER" unmute
		echo false > $WORKDIR/func_mixer-MUTE
	else
		amixer set "$SPEAKER" mute
		echo true > $WORKDIR/func_mixer-MUTE
	fi
	;;
-up_TREBLE)
	TREBLE=`amixer get Treble | grep 'Left:' | cut -d '%' -f 1 | cut -d '[' -f 2`
	TMP=`expr $TREBLE + 9`
	amixer set Treble $TMP"%",$TMP"%"
	echo -e "|`head -c 9 $WORKDIR/TREBLE`\c" > $WORKDIR/TREBLE
	;;
-down_TREBLE)
	TREBLE=`amixer get Treble | grep 'Left:' | cut -d '%' -f 1 | cut -d '[' -f 2`
	TMP=`expr $TREBLE - 11`
	amixer set Treble $TMP"%",$TMP"%"
	[ "`grep '||||||||||' $WORKDIR/TREBLE`" ] && echo -e '||||||||| \c' > $WORKDIR/TREBLE
	echo -e "`tail -c 9 $WORKDIR/TREBLE` \c" > $WORKDIR/TREBLE
	;;
-up_BASS)
	BASS=`amixer get Bass | grep 'Left:' | cut -d '%' -f 1 | cut -d '[' -f 2`
	TMP=`expr $BASS + 9`
	amixer set Bass $TMP"%",$TMP"%"
	echo -e "|`head -c 9 $WORKDIR/BASS`\c" > $WORKDIR/BASS
	;;
-down_BASS)
	BASS=`amixer get Bass | grep 'Left:' | cut -d '%' -f 1 | cut -d '[' -f 2`
	TMP=`expr $BASS - 11`
	amixer set Bass $TMP"%",$TMP"%"
	[ "`grep '||||||||||' $WORKDIR/BASS`" ] && echo -e '||||||||| \c' > $WORKDIR/BASS
	echo -e "`tail -c 9 $WORKDIR/BASS` \c" > $WORKDIR/BASS
	;;
-upMono)
	VOL=`amixer get "$SPEAKER" | grep 'Mono:' | cut -d '%' -f 1 | cut -d '[' -f 2`
	TMP=`expr $VOL + 9`
	amixer set "$SPEAKER" $TMP"%"
	echo -e "|`head -c 9 $WORKDIR/VOL_L`\c" > $WORKDIR/VOL_L
	echo -e "|`head -c 9 $WORKDIR/VOL_R`\c" > $WORKDIR/VOL_R
	;;
-downMono)
	VOL=`amixer get "$SPEAKER" | grep 'Mono:' | cut -d '%' -f 1 | cut -d '[' -f 2`
	TMP=`expr $VOL - 11`
	amixer set "$SPEAKER" $TMP"%"
	echo -e "`tail -c 9 $WORKDIR/VOL_L` \c" > $WORKDIR/VOL_L
	echo -e "`tail -c 9 $WORKDIR/VOL_R` \c" > $WORKDIR/VOL_R
	;;
-up_VOL_L)
	if [ "`amixer get "$SPEAKER" | grep 'Mono:' | cut -d ':' -f 2`" ]; then . $APPDIR/func_mixer -upMono; exit; fi
	VOL_LEFT=`amixer get "$SPEAKER" | grep 'Left:' | cut -d '%' -f 1 | cut -d '[' -f 2`
	VOL_RIGHT=`amixer get "$SPEAKER" | grep 'Right:' | cut -d ']' -f 1 | cut -d '[' -f 2`
	TMP=`expr $VOL_LEFT + 9`
	amixer set "$SPEAKER" $TMP"%",$VOL_RIGHT
	echo -e "|`head -c 9 $WORKDIR/VOL_L`\c" > $WORKDIR/VOL_L
	;;
-down_VOL_L)
	if [ "`amixer get "$SPEAKER" | grep 'Mono:' | cut -d ':' -f 2`" ]; then . $APPDIR/func_mixer -downMono; exit; fi
	VOL_LEFT=`amixer get "$SPEAKER" | grep 'Left:' | cut -d '%' -f 1 | cut -d '[' -f 2`
	VOL_RIGHT=`amixer get "$SPEAKER" | grep 'Right:' | cut -d ']' -f 1 | cut -d '[' -f 2`
	TMP=`expr $VOL_LEFT - 11`
	amixer set "$SPEAKER" $TMP"%",$VOL_RIGHT
	[ "`grep '||||||||||' $WORKDIR/VOL_L`" ] && echo -e '||||||||| \c' > $WORKDIR/VOL_L
	echo -e "`tail -c 9 $WORKDIR/VOL_L` \c" > $WORKDIR/VOL_L
	;;
-up_VOL_R)
	if [ "`amixer get "$SPEAKER" | grep 'Mono:' | cut -d ':' -f 2`" ]; then . $APPDIR/func_mixer -upMono; exit; fi
	VOL_LEFT=`amixer get "$SPEAKER" | grep 'Left:' | cut -d ']' -f 1 | cut -d '[' -f 2`
	VOL_RIGHT=`amixer get "$SPEAKER" | grep 'Right:' | cut -d '%' -f 1 | cut -d '[' -f 2`
	TMP=`expr $VOL_RIGHT + 9`
	amixer set "$SPEAKER" $VOL_LEFT,$TMP"%"
	echo -e "|`head -c 9 $WORKDIR/VOL_R`\c" > $WORKDIR/VOL_R
	;;
-down_VOL_R)
	if [ "`amixer get "$SPEAKER" | grep 'Mono:' | cut -d ':' -f 2`" ]; then . $APPDIR/func_mixer -downMono; exit; fi
	VOL_LEFT=`amixer get "$SPEAKER" | grep 'Left:' | cut -d ']' -f 1 | cut -d '[' -f 2`
	VOL_RIGHT=`amixer get "$SPEAKER" | grep 'Right:' | cut -d '%' -f 1 | cut -d '[' -f 2`
	TMP=`expr $VOL_RIGHT - 11`
	amixer set "$SPEAKER" $VOL_LEFT,$TMP"%"
	[ "`grep '||||||||||' $WORKDIR/VOL_R`" ] && echo -e '||||||||| \c' > $WORKDIR/VOL_R
	echo -e "`tail -c 9 $WORKDIR/VOL_R` \c" > $WORKDIR/VOL_R
	;;
-get_levels)
	echo -e "\c" > $WORKDIR/VOL_L
	echo -e "\c" > $WORKDIR/VOL_R
	if [ ! "`amixer get "$SPEAKER" | grep 'Mono:' | cut -d ':' -f 2`" ]; then 
		for I in {1..10}; do
			VOL_LEFT=`amixer get "$SPEAKER" | grep 'Left:' | cut -d '%' -f 1 | cut -d '[' -f 2`
			[ $VOL_LEFT -ge `expr $I \* 10` ] && echo -e "|\c" >> $WORKDIR/VOL_L
			[ $VOL_LEFT -lt `expr $I \* 10` ] && echo -e " \c" >> $WORKDIR/VOL_L
			VOL_RIGHT=`amixer get "$SPEAKER" | grep 'Right:' | cut -d '%' -f 1 | cut -d '[' -f 2`
			[ $VOL_RIGHT -ge `expr $I \* 10` ] && echo -e "|\c" >> $WORKDIR/VOL_R
			[ $VOL_RIGHT -lt `expr $I \* 10` ] && echo -e " \c" >> $WORKDIR/VOL_R
		done
	else #mono
		for I in {1..10}; do
			VOL=`amixer get "$SPEAKER" | grep 'Mono:' | cut -d '%' -f 1 | cut -d '[' -f 2`
			if [ $VOL -ge `expr $I \* 10` ]; then
				echo -e "|\c" >> $WORKDIR/VOL_L
				echo -e "|\c" >> $WORKDIR/VOL_R
			fi
			if [ $VOL -lt `expr $I \* 10` ]; then
				echo -e " \c" >> $WORKDIR/VOL_L
				echo -e " \c" >> $WORKDIR/VOL_R
			fi
		done
	fi
	#bass/treble
	echo -e "\c" > $WORKDIR/TREBLE
	echo -e "\c" > $WORKDIR/BASS
	if [ "`amixer get Bass 2> /dev/null | grep 'Left:' | cut -d ':' -f 2`" ]; then 
		for I in {1..10}; do
			TREBLE=`amixer get Treble | grep 'Left:' | cut -d '%' -f 1 | cut -d '[' -f 2`
			[ $TREBLE -ge `expr $I \* 10` ] && echo -e "|\c" >> $WORKDIR/TREBLE
			[ $TREBLE -lt `expr $I \* 10` ] && echo -e " \c" >> $WORKDIR/TREBLE
			BASS=`amixer get Bass | grep 'Left:' | cut -d '%' -f 1 | cut -d '[' -f 2`
			[ $BASS -ge `expr $I \* 10` ] && echo -e "|\c" >> $WORKDIR/BASS
			[ $BASS -lt `expr $I \* 10` ] && echo -e " \c" >> $WORKDIR/BASS
		done
		EQUALIZER_VISIBLE=enabled
	else #not supported
		EQUALIZER_VISIBLE=disabled
		echo -e "|||||     \c" > $WORKDIR/BASS
		echo -e "|||||     \c" > $WORKDIR/TREBLE
	fi
	;;
esac
# Very End of this file 'usr/local/pmusic/func_mixer' #
###END###

#!/bin/sh
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_changeKey"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/local/jwmconfig2/changeKey"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in 1; do shift; done; }

_trap

}
# End new header
#

####
#
# changeKey: to be used with the
# jwmConfigMgr and keyboard scripts
# provides gui for changing or deleting
# a shortcut
#
# author: thoughtjourney
# date: 22/08/2005
#
# modified by kwiller on 07-May-2006
# to allow use of multiple mask keys
#
#
####


########################################################################
#
#
#
#
#
# /dev/hda7
# /dev/hda7:
# LABEL="/"
# UUID="429ee1ed-70a4-43a5-89f8-33496c489260"
# TYPE="ext4"
# DISTRO_NAME='Lucid·Puppy'
# DISTRO_VERSION=218
# DISTRO_MINOR_VERSION=00
# DISTRO_BINARY_COMPAT='ubuntu'
# DISTRO_FILE_PREFIX='luci'
# DISTRO_COMPAT_VERSION='lucid'
# DISTRO_KERNEL_PET='linux_kernel-2.6.33.2-tickless_smp_patched-L3.pet'
# PUPMODE=2
# SATADRIVES=''
# PUP_HOME='/'
# PDEV1='hda7'
# DEV1FS='ext4'
# Linux·puppypc·2.6.31.14·#1·Mon·Jan·24·21:03:21·GMT-8·2011·i686·GNU/Linux
# Xserver=/usr/bin/Xorg
# $LANG=en_US
# today=Tue·Oct·25·19:11:12·GMT+1·2011
#
#
#
#
#
########################################################################

#------------variables--------------->>
TMP1="/tmp/JWMconfig/addmask.tmp.$$"
TMP2="/tmp/JWMconfig/maskkey.tmp.$$"
K=
M=
MASK=`echo $KEY | grep -c mask`
A=
TMPFILE="/tmp/JWMconfig/shortcut"
#SCRIPT_DIR="/root/.jwm"
SCRIPT_DIR="/usr/local/jwmconfig"
ID=

PATH1=$PATH

#-----find key value and mask value--->>

if [ $MASK -eq 1 ]; then
   M=`echo $KEY | awk -F\" '/key/ {print $2}'`
   K=`echo $KEY | awk -F\" '/key/ {print $4}'`
   echo M: $M
   echo K: $K
else
   K=`echo $KEY | awk -F\" '/key/ {print $2}'`
   echo K: $K
fi
echo key $KEY
export $KEY

##------------write current key details to a file--------->>

echo "old|$M|$K">/tmp/JWMconfig/short
sync

#-------find line in config file------>>

if [ $MASK -eq 1 ]; then
   RES=`echo $KEY | awk -F_ '/mask/ {print $1 " " $2}'`
else
   RES=$KEY
fi

echo res $RES

KEYLINE=`grep "$RES" /root/.jwm/jwmrc-personal`

#xmessage -name "Current Details" -nearmouse "Current shortcut details:  $KEYLINE" &
   echo $KEYLINE
   A=`echo $KEYLINE | awk -F\> '/key/ {print $2}' | awk -F\< '/Key/ {print $1}'`
   export A

##------write to temp file------------>>

MASKKEY=

if [ -z $M  ]; then
   echo -e "KEY:        $K\nACTION:  $A" > $TMPFILE
else
  echo "$M" > $TMP1
  sed -e "s#A#Alt-#" \
      -e "s#C#Ctrl-#" \
      -e "s#H#Hyper-#" \
      -e "s#M#Meta-#" \
      -e "s#S#Shift-#" \
      -e "s#P#Super-#" $TMP1 > $TMP2

  MASKKEY=`cat $TMP2`
  rm -f $TMP1
  rm -f $TMP2

  echo -e "KEY COMBO:  $MASKKEY$K\nACTION:           $A" > $TMPFILE
fi
#   echo A: $A >> /tmp/JWMconfig/shortcut

##---taskbar config for jwmConfigMgr--->>

export Change_Shortcut="
 <vbox>
  <frame Shortcut Details>
   <hbox>
    <edit><input file>$TMPFILE</input><width>300</width><height>45</height></edit>
   </hbox>
  </frame>
  <frame Delete>
   <hbox>
    <pixmap><input file>mini-cross.xpm</input></pixmap>
    <checkbox>
      <label>Delete this shortcut?</label>
      <default>no</default>
      <action>if true disable:MSK</action>
      <action>if true disable:KY</action>
      <action>if false enable:MSK</action>
      <action>if false enable:KY</action>
      <variable>CHECK</variable>
    </checkbox>
   </hbox>
  </frame>
  <frame Change Shortcut>
   <hbox>
    <text><label>Enter Mask (optional):</label></text>
    <entry>
     <default>mask</default>
     <visible>enabled</visible>
      <variable>MSK</variable>
    </entry>
    <text><label>Enter Key:</label></text>
    <entry>
     <default>key</default>
     <visible>enabled</visible>
      <variable>KY</variable>
    </entry>
   </hbox>
  </frame>
   <hbox>
   <button ok>
     <action>confirmKey &</action>
     <action>exit</action>
   </button>
   <button help>
      <action>dillo http://www.joewing.net/programs/jwm/config.shtml#keys &</action>
   </button>
   <button cancel></button>
   </hbox>
 </vbox>"

##----------run------------>>
cd $SCRIPT_DIR
export PATH="$PATH:."
gtkdialog3 --program Change_Shortcut

##-------cleanup---------->>
#rm -f $TMPFILE
unset Change_Shortcut
unset A
export PATH=$PATH1
#clear
# Very End of this file 'usr/local/jwmconfig2/changeKey' #
###END###

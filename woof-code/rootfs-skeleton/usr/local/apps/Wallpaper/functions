#!/bin/sh

# Determine the path to this application.
CURDIR="`pwd`"
APPDIR=`dirname "$0"`
cd "${APPDIR}"
APPDIR="`pwd`"
cd "${CURDIR}"
LOG=/tmp/backg.log
echo "$0:$*" >>"$LOG"
VERSION="0.6.1-1.sp"

[[ "$*" ]] || { return 0 2>/dev/null || exit; }
. "$APPDIR"/common.sau

### begin About ###
about_wallpaper() {
export ABOUT_DLG="
<window title=\"$LOC_ABOUT_WINDOW\" icon_name=\"gtk-about\" window_position=\"2\">
 <vbox>
  <text use_markup=\"true\">
   <label>\"<b>Wallpaper-$VERSION</b>\"</label>
  </text>
  <frame $LOC_ABOUT_FRAME>
   <text>
    <label>\"$LOC_ABOUT_TEXT\"</label>
   </text>
  </frame>
  <hbox>
   <button>
    <label>\"$LOC_CLOSE\"</label>
    <input file stock=\"gtk-close\"></input>
   </button>
  </hbox>
 </vbox>
</window>
"
gtkdialog4 --program ABOUT_DLG &
}
### end About ###

## begin Preferences ###
wallpaper_preferences() {
    echo "INT=$INT" >>$LOG
echo "$INT" > "$HOME"/.config/wallpaper/int
# REM: Xdialog 2rangesbox
export PREFS_DLG="
<window title=\"$LOC_OPTIONS_WINDOW\" icon_name=\"gtk-preferences\">
 <vbox>
  <frame $LOC_SLIDESHOW_FRAME>
   <text>
    <label>\"$LOC_DELAY\"</label>
   </text>
   <hbox>
    <entry editable=\"false\">
     <input>cat \"\$HOME\"/.config/wallpaper/int</input>
     <variable>INT</variable>
    </entry>
    <button>
     <label>\"$LOC_CHOOSE\"</label>
     <action>Xdialog --stdout --2rangesbox \"$LOC_DELAY\" 0 0 \"$LOC_DELAY_1\" 1 60 ${INT%/*} \"$LOC_DELAY_2\" 1 3 ${INT#*/} > \"$HOME\"/.config/wallpaper/int</action>
     <action type=\"refresh\">INT</action>
    </button>
   </hbox>
   <text>
    <label>\"$LOC_DIR\"</label>
   </text>
   <hbox>
    <entry accept=\"directory\">
     <default>\"$SLIDEDIR\"</default>
     <variable>SLIDEDIR</variable>
    </entry>
    <button>
     <input file stock=\"gtk-open\"></input>
     <action type=\"fileselect\">SLIDEDIR</action>
    </button>
   </hbox>
  </frame>
  <frame $LOC_DEFAULTS>
   <hbox>
    <text>
     <label>\"$LOC_FILEMANAGER\"</label>
    </text>
    <entry>
     <variable>FILER</variable>
     <input>cat \"\$HOME\"/.config/wallpaper/FILER</input>
    </entry>
    <button>
     <input file stock=\"gtk-open\"></input>
     <action>programchooser \"\$FILER\" \"system-file-manager\" \"FileManager\" \"None\" > \"\$HOME\"/.config/wallpaper/FILER</action>
     <action type=\"refresh\">FILER</action>
    </button>
   </hbox>
   <hbox>
    <text>
     <label>\"$LOC_VIEWER\"</label>
    </text>
    <entry>
     <variable>VIEWER</variable>
     <input>cat \"\$HOME\"/.config/wallpaper/VIEWER</input>
    </entry>
    <button>
     <input file stock=\"gtk-open\"></input>
     <action>programchooser \"\$VIEWER\" \"image-x-generic\" \"2DGraphics\" \"None\" > \"\$HOME\"/.config/wallpaper/VIEWER</action>
     <action type=\"refresh\">VIEWER</action>
    </button>
   </hbox>
   <hbox>
    <text>
     <label>\"$LOC_EDITOR\"</label>
    </text>
    <entry>
     <variable>IMGEDITOR</variable>
     <input>cat \"\$HOME\"/.config/wallpaper/EDITOR</input>
    </entry>
    <button>
     <input file stock=\"gtk-open\"></input>
     <action>programchooser \"\$IMGEDITOR\" \"image-x-generic\" \"2DGraphics\" \"Viewer\" > \"\$HOME\"/.config/wallpaper/EDITOR</action>
     <action type=\"refresh\">IMGEDITOR</action>
    </button>
   </hbox>
  </frame>
  <hbox>
   <button>
    <label>\"$LOC_CLOSE\"</label>
    <input file stock=\"gtk-close\"></input>
   </button>
  </hbox>
 </vbox>
</window>
"
gtkdialog4 --program PREFS_DLG > "$HOME"/.config/wallpaper/preferences
rm -f "$HOME"/.config/wallpaper/int
}
### end Preferences ###

### begin Filer ###
open_filer() {
. "$PREFS"
DIR=`cat "$HOME"/.config/wallpaper/bgdir`
#exec "$FILER" "$DIR" &
[ -d "$DIR" ] || return 1
exec "$FILER" "$DIR"
}
### end Filer ###

# parse our arguments
case $1 in
 -about)
 about_wallpaper
 exit 0
 ;;
 -preferences)
 wallpaper_preferences
 exit 0
 ;;
 -filer)
 open_filer
 exit 0
 ;;
 *)
 exit
 ;;
esac






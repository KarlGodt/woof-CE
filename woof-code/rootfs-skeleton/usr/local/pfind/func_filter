#!/bin/bash
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_func_filter"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/local/pfind/func_filter"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in 1; do shift; done; }

_trap

}
# End new header
#
FILTER=$1
cp /tmp/pfind-view$PROGPID /tmp/pfind-tmp$PROGPID
case $FILTER in
	-Find_files_in_list)
		FRAME="$LOC606"; IMG="find";
		TXT1="$LOC607"
		. "$PROGPATH"box_input
		if [ $EXIT = "ok" ]; then
			GREPSTRING=`echo "$INPUT" | sed -e 's/ \[/\[/g' | sed -e 's/\] /\]/g'` #remove some spaces
			GREPSTRING=`echo "$GREPSTRING" | sed -e 's/\[OR\]/\\\|/g'` #convert to grep syntax
			grep "('\|$GREPSTRING\|')" /tmp/pfind-tmp$PROGPID > /tmp/pfind-view$PROGPID
		fi;;
	-Remove_files_from_list)
		FRAME="$LOC606"; IMG="clear";
		TXT1="$LOC608"
		. "$PROGPATH"box_input
		if [ $EXIT = "ok" ]; then
			GREPSTRING=`echo "$INPUT" | sed -e 's/ \[/\[/g' | sed -e 's/\] /\]/g'` #remove some spaces
			GREPSTRING=`echo "$GREPSTRING" | sed -e 's/\[OR\]/\\\|/g'` #convert to grep syntax
			grep -v "('\|$GREPSTRING\|')" /tmp/pfind-tmp$PROGPID > /tmp/pfind-view$PROGPID
		fi;;
	-Search_for_TEXT_in_files)
		FRAME="$LOC606"; IMG="find";
		TXT1="$LOC609"
		. "$PROGPATH"box_input
		if [ $EXIT = "ok" ]; then
			GREPSTRING=`echo "$INPUT" | sed -e 's/\[OR\]/\\\|/g'` #convert to grep syntax
			echo -e "\c" > /tmp/pfind-view$PROGPID
			TMP=`sed -i -e "s/ /{ð®Sđþ}/g" /tmp/pfind-tmp$PROGPID`
			for I in $TMP; do
				TMP2=`echo $I | sed -e 's/{ð®Sđþ}/ /g'`
				grep -il "$GREPSTRING" "$TMP2" >> /tmp/pfind-view$PROGPID
			done
		fi;;
esac
# Very End of this file 'usr/local/pfind/func_filter' #
###END###

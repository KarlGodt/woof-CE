#!/bin/sh
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_func_crashreport"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/local/psip/func_crashreport"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in 1; do shift; done; }

_trap

}
# End new header
#
cd /tmp
grep -v password $PJCFG > $PJTMP/pjsua.cfg
cat $PJTMP/pjsua.cfg
USER="$(cat $PJTMP/pjsua.cfg | grep username | sed 's/--username//;s/ //g')"
echo "About to compile PSIP crash report"
echo "This will contain IP addresses, account names and IM messages but no passwords"
echo "The information above from your config file will be included in the report."
echo "Please make sure it does not contain passwords or other information you do not want to send."
echo "When you press enter the report will be saved in a tar.gz file in /tmp"
read a
cp -r psip "psip-crash-$USER-$(date +%y-%m-%d-%H-%M-%S)"
tar -cvzf "psip-crash-$USER-$(date +%y-%m-%d-%H-%M-%S).tar.gz" "psip-crash-$USER-$(date +%y-%m-%d-%H-%M-%S)"
echo
echo "Crash report saved in /tmp now you can email it to Will"
echo "It would probably be sensible to stop and then start pjsua before trying to use it again."
echo "Hit return to close this window and open /tmp"
read a
rox /tmp
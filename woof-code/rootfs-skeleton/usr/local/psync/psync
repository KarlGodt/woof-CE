#!/bin/bash
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_psync"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/local/psync/psync"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in 1; do shift; done; }

_trap

}
# End new header
#
#Psync Time Synchroniser Gui 
#Synchronises system and hardware clock to a public time server
#Robert Lane 2009 2010 (tasmod)

[ ! "`grep 'ntp 123/tcp' /etc/services`" ] && echo -e "ntp 123/tcp\nntp 123/udp" >> /etc/services
CURRENT_HW=`hwclock -r`
CURRENT_TIME=`date +%X%t%Z`
OFF=`date +%z`
#set browser
if [ "`which defaultbrowser 2> /dev/null`" ]; then export BROWSER=defaulthtmlviewer
	elif [ "`which hv3 2> /dev/null`" ]; then export BROWSER=hv3
	elif [ "`which dillo 2> /dev/null`" ]; then export BROWSER=dillo
	elif [ "`which mozilla 2> /dev/null`" ]; then export BROWSER=mozilla
	elif [ "`which opera 2> /dev/null`" ]; then export BROWSER=opera
	elif [ "`which netscape 2> /dev/null`" ]; then export BROWSER=netscape
	elif [ "`which firefox 2> /dev/null`" ]; then export BROWSER=firefox
	elif [ "`which konqueror 2> /dev/null`" ]; then export BROWSER=konqueror
fi
cd $HOME
export Psync="
<window title=\"        Psync Time Server Synchroniser Version 1.1\"  >
 <vbox>
  <frame ---------------------------------System Time>
     <text use-markup=\"true\"><label>\"<b>$CURRENT_TIME</b>\"</label></text>
     </frame>
	 <frame ----------------Hardware Time & Offset to system time >
	 <text use-markup=\"true\"><label>\"<b>$CURRENT_HW</b>\"</label></text>
     </frame>
	 <hbox>
	 <frame ------------TZ Variable>
     <text use-markup=\"true\"><label>\"<b>$TZ</b>\"</label></text>
     </frame>
	 <frame ----------Offset to UTC>
     <text use-markup=\"true\"><label>\"<b>$OFF</b>\"</label></text>
     </frame>
	 </hbox>
	 <frame>
	 <text><label> To synchronise your clock. </label></text>
	 <text><label>Choose a Time Server Region nearest to you. </label></text>
	 <text><label> Can take up to a minute or so. </label></text>
	 </frame>
     <frame>
	 <text><label>If display blanks, please wait. </label></text>
	 <text><label>It may take a short while to set the time.</label></text>
	 <text><label>After setting the time there is an option to do this automatically at each startup.</label></text>
	 <text><label>Please read the 'Help' file for more information.</label></text>
	 <text><label> \"       \"  </label></text>
	 <hbox>
     <button>
     <input file icon=\"gtk-execute\"></input>
     <label>Africa  </label>
	 <action> /usr/local/pysnc/psyncfunc AFRICA</action>
	 <action> exit: gtkdialogue </action>
     </button>
	 <button>
     <input file icon=\"gtk-execute\"></input>
     <label>Asia   </label>
	 <action> /usr/local/psync/psyncfunc ASIA</action>
	 <action> exit: gtkdialogue </action>
     </button>
	 <button>
     <input file icon=\"gtk-execute\"></input>
     <label>Europe   </label>
	 <action> /usr/local/psync/psyncfunc EUROPE</action>
	 <action> exit: gtkdialogue </action>
     </button>
	 <button>
     <input file icon=\"gtk-execute\"></input>
     <label>United Kingdom   </label>
	 <action> /usr/local/psync/psyncfunc UK</action>
	 <action> exit: gtkdialogue </action>
     </button>
	 </hbox>
	 <text><label>\"       \"</label></text>
	 <hbox>
	 <button>
     <input file icon=\"gtk-execute\"></input>
     <label>North America </label>
	 <action> /usr/local/psync/psyncfunc NORTHAMERICA</action>
	 <action> exit: gtkdialogue </action>
     </button>
	 <button>
     <input file icon=\"gtk-execute\"></input>
     <label>South America </label>
	 <action> /usr/local/psync/psyncfunc SOUTHAMERICA</action>
	 <action> exit: gtkdialogue </action>
     </button>
	 <button>
     <input file icon=\"gtk-execute\"></input>
     <label>Oceania </label>
	 <action> /usr/local/psync/psyncfunc OCEANIA</action>
	 <action> exit: gtkdialogue </action>
     </button>
	 <text><label>\"       \"</label></text>	 
	 </hbox>
	 <text><label>\"       \"</label></text>
	 </frame>
	 <frame>
     <hbox>
	 <button>
     <input file icon=\"gtk-help\"></input>
     <label>Help</label>
	 <action> $BROWSER /usr/share/doc/psync.html</action>
	 <action> exit: gtkdialogue </action>
     </button>
	 <text><label>\"       \"</label></text>
	 <text><label>\"       \"</label></text>
     <button>
     <input file icon=\"gtk-cancel\"></input>
     <label>Close</label>
     </button>
	 <text><label>\"       \"</label></text>
	 <text><label>\"       \"</label></text>
	 <text><label>\"    \"</label></text>
     </hbox>
     </frame>
     </vbox>
</window>"

#execute gtkdialog
gtkdialog3  -c -p  Psync

# Very End of this file 'usr/local/psync/psync' #
###END###

#!/bin/sh
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_changeKey"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/local/jwmconfig3_2011_10_30/changeKey"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in 1; do shift; done; }

_trap

}
# End new header
#


########################################################################
#
#
#
#
#
# /dev/hda8:
# LABEL="MacPup431_O2"
# UUID="6d9a8e91-c301-4ff8-9875-97ec708cbee8"
# TYPE="ext3"
# DISTRO_NAME='Puppy'
# DISTRO_VERSION=431
# DISTRO_BINARY_COMPAT='puppy'
# DISTRO_FILE_PREFIX='pup'
# DISTRO_COMPAT_VERSION='4'
# PUPMODE=2
# KERNVER=2.6.37.4-KRG-i486-StagingDrivers-2
# PUP_HOME='/'
# SATADRIVES='·'
# USBDRIVES='·sda·'
# Linux·puppypc·2.6.37.4-KRG-i486-StagingDrivers-2·#4·SMP·Thu·Mar·17·06:05:58·GMT-8·2011·i686·GNU/Linux
# X·Window·System·Version·1.3.0
# Release·Date:·19·April·2007
# X·Protocol·Version·11,·Revision·0,·Release·1.3
# Build·Operating·System:·UNKNOWN·
# Current·Operating·System:·Linux·puppypc·2.6.37.4-KRG-i486-StagingDrivers-2·#4·SMP·Thu·Mar·17·06:05:58·GMT-8·2011·i686
# Build·Date:·28·November·2007
# $LANG=de_DE@euro
# today=So·30.·Okt·12:47:47·GMT+1·2011
#
#
#
#
#
########################################################################

####
#
# changeKey: to be used with the 
# jwmConfigMgr and keyboard scripts
# provides gui for changing or deleting
# a shortcut
# 
# author: thoughtjourney
# date: 22/08/2005
#
# modified by kwiller on 07-May-2006
# to allow use of multiple mask keys
#
#
####

#------------variables--------------->>
PRO="/changeKey"

SCRIPT_DIR="/usr/local/jwmconfig3"		
. "$SCRIPT_DIR"/path

#-----find key value and mask value--->>

if [ "$MASK" -eq 1 ]; then
   M=`echo "$KEY" | awk -F\" '/key/ {print $2}'`
   K=`echo "$KEY" | awk -F\" '/key/ {print $4}'`
   echo $DBG 30 M: $M
   echo $DBG 31 K: $K 
else
   K=`echo "$KEY" | awk -F\" '/key/ {print $2}'`
   echo $DBG 34 K: $K  
fi
echo $DBG 36 key: $KEY

A=`echo "$KEY" | cut -f 2 -d " " | cut -f 2 -d ":"`
##------------write current key details to a file--------->>

echo "old|$M|$K|$A" > "$TmpSCO"
sync

#-------find line in config file------>>

if [ "$MASK" -eq 1 ]; then
   RES=`echo "$KEY" | awk -F_ '/mask/ {print $1 " " $2}'`
else
   RES="$KEY"
fi

echo $DBG 52 res: $RES

#KEYLINE=`grep "$RES" /root/.jwm/jwmrc-personal`  ##2011_10_30 change to $HOME
KEYLINE=`grep "$RES" "$PersonalFile"`

#xmessage -name "Current Details" -nearmouse "Current shortcut details:  $KEYLINE" &
   echo $DBG 57$KEYLINE
   # A=`echo $KEYLINE | awk -F\> '/key/ {print $2}' | awk -F\< '/Key/ {print $1}'`
   

##------write to temp file------------>>

MASKKEY=

if [ -z "$M"  ]; then
   echo -e "KEY:        $K\nACTION:  $A" > "$TmpSC"
else
  echo "$M" > "$TmpAM"
  sed -e "s#A#Alt-#" \
      -e "s#C#Ctrl-#" \
      -e "s#H#Hyper-#" \
      -e "s#M#Meta-#" \
      -e "s#S#Shift-#" \
      -e "s#P#Super-#" "$TmpAM" > "$TmpMK"
 
  MASKKEY=`cat "$TmpMK" | tail -n1`
  rm -f "$TmpAM"
  rm -f "$TmpMK"

  echo -e "KEY COMBO:  $MASKKEY$K\nACTION:           $A" > "$TmpSC"
fi
#   echo A: $A >> /tmp/shortcut

##---taskbar config for jwmConfigMgr--->>

export Change_Shortcut="
 <vbox>
  <frame Shortcut Details>
   <hbox>
    <edit><input file>$TmpSC</input><width>300</width><height>45</height></edit> 
   </hbox>
  </frame>
  <frame Delete>
   <hbox>
    <pixmap><input file>$MINI_ICONS_DIR/mini-cross.xpm</input></pixmap>
    <checkbox>
      <label>Delete this shortcut?</label>
      <default>no</default>
      <action>if true disable:MSK</action>
      <action>if true disable:KY</action>
      <action>if false enable:MSK</action>
      <action>if false enable:KY</action>
      <variable>CHECK</variable>
    </checkbox>
   </hbox>
  </frame>
  <frame Change Shortcut>
   <hbox>
    <text><label>Enter Mask (optional):</label></text>
    <entry>
     <default>mask</default>
     <visible>enabled</visible>
      <variable>MSK</variable>
    </entry>
    <text><label>Enter Key:</label></text>
    <entry>
     <default>key</default>
     <visible>enabled</visible>
      <variable>KY</variable>
    </entry>
   </hbox>
  </frame>
   <hbox>
   <button ok>
     <action>confirmKey &</action>
     <action>EXIT:ok</action>
   </button>
   <button help>
      <action>defaulthtmlviewer http://www.joewing.net/programs/jwm/config.shtml#keys &</action>
   </button>
   <button cancel></button>
   </hbox>
 </vbox>"

##----------run------------>>
cd $SCRIPT_DIR
export PATH="$PATH:."
gtkdialog3 --program Change_Shortcut

##-------cleanup---------->>
unset Change_Shortcut	

export PATH=$PATH1
	



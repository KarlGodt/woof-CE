#! /bin/bash
while [ "`cat /tmp/pstopwatch-status`" != "stop" ]; do
	if [ `date +%H:%M:%S` != `tail -1 /tmp/pstopwatch-clock` ]; then date +%H:%M:%S >> /tmp/pstopwatch-clock; fi
	#check for alarm
	HOUR=`date +%H`
	MIN=`date +%M`
	if [ "$CLOCK_ALARM" ]; then
		ALARM_HOUR=`echo "$CLOCK_ALARM" | cut -d ':' -f 1`
		ALARM_MIN=`echo "$CLOCK_ALARM" | cut -d ':' -f 2`
		if [ $ALARM_HOUR -le $HOUR ] && [ `expr $HOUR - 1` -le $ALARM_HOUR ] && [ $ALARM_MIN -le $MIN ]; then
			TMP=`ps`
			if [ ! "`echo "$TMP" | grep $COMMAND_ALARM`" ]; then
				$COMMAND_ALARM > /dev/null 2>&1 &
			fi
		fi
	fi
	usleep 100000
done
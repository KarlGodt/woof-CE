#! /bin/bash
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_pstopwatch_clock"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/local/pstopwatch/pstopwatch_clock"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap

}
# End new header
#
while [ "`cat /tmp/pstopwatch-status`" != "stop" ]; do
	if [ `date +%H:%M:%S` != `tail -1 /tmp/pstopwatch-clock` ]; then date +%H:%M:%S >> /tmp/pstopwatch-clock; fi
	#check for alarm
	HOUR=`date +%H`
	MIN=`date +%M`
	if [ "$CLOCK_ALARM" ]; then
		ALARM_HOUR=`echo "$CLOCK_ALARM" | cut -d ':' -f 1`
		ALARM_MIN=`echo "$CLOCK_ALARM" | cut -d ':' -f 2`
		if [ $ALARM_HOUR -le $HOUR ] && [ `expr $HOUR - 1` -le $ALARM_HOUR ] && [ $ALARM_MIN -le $MIN ]; then
			TMP=`ps`
			if [ ! "`echo "$TMP" | grep $COMMAND_ALARM`" ]; then
				$COMMAND_ALARM > /dev/null 2>&1 &
			fi
		fi
	fi
	usleep 100000
done
#! /bin/bash

source /etc/rc.d/f4puppy5

#aplay /usr/share/audio/beep_high.wav
#aplay /usr/share/audio/beep_high.wav
#aplay /usr/share/audio/beep_low.wav

[ "$BEEP_INTERVAL" ] || BEEP_INTERVAL=1000000 #1million=1s

if [ "$COMMAND_ALARM" =~ "aplay" ];then
BEEP=Y
fi

if [ "BEEP" ];then
while [ "`cat /tmp/pstopwatch-status`" != "stop" ]; do
    if [ `date +%H:%M:%S` != `tail -1 /tmp/pstopwatch-clock` ]; then date +%H:%M:%S >> /tmp/pstopwatch-clock; fi
    #check for alarm
    HOUR=`date +%H`
    MIN=`date +%M`
    if [ "$CLOCK_ALARM" ]; then
        ALARM_HOUR=`echo "$CLOCK_ALARM" | cut -d ':' -f 1`
        ALARM_MIN=`echo "$CLOCK_ALARM" | cut -d ':' -f 2`
        #if [ $ALARM_HOUR -le $HOUR ] && [ `expr $HOUR - 1` -le $ALARM_HOUR ] && [ $ALARM_MIN -le $MIN ]; then
        if [ "$HOUR" = $ALARM_HOUR ] && [ "$MIN" = $ALARM_MIN ];then
            TMP=`ps`
            if [ ! "`echo "$TMP" | grep $COMMAND_ALARM`" ]; then
                $COMMAND_ALARM >>$OUT 2>>$ERR &
            fi
        fi
    fi
    usleep $BEEP_INTERVAL
done
else
$COMMAND_ALARM "$@"
fi

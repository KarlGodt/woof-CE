#!/bin/bash
#
# New header by Karl Reimer Godt, September 2014
  _TITLE_="Puppy_pcd"
_VERSION_=1.0omega
_COMMENT_="$_TITLE_:Puppy Linux shell script [to TODO here]"

MY_SELF="/usr/local/pcd/pcd"
MY_PID=$$

test -f /etc/rc.d/f4puppy5 && {
source /etc/rc.d/f4puppy5

ADD_PARAMETER_LIST=""
ADD_PARAMETERS=""
_provide_basic_parameters

ADD_HELP_MSG="$_COMMENT_"
_parse_basic_parameters "$@"
[ "$DO_SHIFT" ] && [ ! "${DO_SHIFT//[[:digit:]]/}" ] && {
  for oneSHIFT in `seq 1 1 $DO_SHIFT`; do shift; done; }

_trap

}
# End new header
#
#pcd
#Copyright 2009
#Sigmund Berglund

#------------------------------
#This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation version 2.

#This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. <http://www.gnu.org/licenses/>.
#------------------------------

VERSION=1.0
export WORKDIR=$HOME/.pcd/tmp
APPDIR="`dirname $0`"
[ "$APPDIR" = "." ] && APPDIR="`pwd`"
export APPDIR="$APPDIR"
#initialize
export DEVICE='/dev/cdrom'
mkdir $HOME/.pcd > /dev/null 2>&1
mkdir $HOME/.pcd/tmp > /dev/null 2>&1

#set language
ENVIRONMENT_LANG=`echo $LANG | sed "s/\(..\).*/\1/"` #detect environment language 
case $ENVIRONMENT_LANG in
	aa)	L=afar ;;
	ab)	L=abkhazian ;;
	ae)	L=avestan ;;
	af)	L=afrikaans ;;
	ak)	L=akans ;;
	am)	L=amharic ;;
	an)	L=aragonese ;;
	ar)	L=arabic ;;
	as)	L=assamese ;;
	av)	L=avaric ;;
	ay)	L=aymara ;;
	az)	L=azerbaijani ;;
	be)	L=belarusian ;;
	bg)	L=bulgarian ;;
	bh)	L=bihari ;;
	bi)	L=bislama ;;
	bm)	L=bambara ;;
	bn)	L=bengali ;;
	bo)	L=tibetan ;;
	br)	L=breton ;;
	bs)	L=bosnian ;;
	ca)	L=catalan ;;
	ce)	L=chechen ;;
	ch)	L=chamorro ;;
	co)	L=corsican ;;
	cr)	L=cree ;;
	cs)	L=czech ;;
	cu)	L=church_slavic ;;
	cv)	L=chuvash ;;
	cy)	L=welsh ;;
	da)	L=danish ;;
	de)	L=german ;;
	dv)	L=divehi ;;
	dz)	L=dzonkha ;;
	ee)	L=ewe ;;
	el)	L=greek ;;
	en)	L=english ;;
	eo)	L=esperanto ;;
	es)	L=spanish ;;
	et)	L=estonian ;;
	eu)	L=basque ;;
	fa)	L=persian ;;
	ff)	L=fulah ;;
	fi)	L=finnish ;;
	fj)	L=fijian ;;
	fo)	L=faroese ;;
	fr)	L=french ;;
	fy)	L=western frisian ;;
	ga)	L=irish ;;
	gd)	L=gaelic ;;
	gl)	L=galician ;;
	gn)	L=guarani ;;
	gu)	L=gujarati ;;
	gv)	L=manx ;;
	ha)	L=hausa ;;
	he)	L=hebrew ;;
	hi)	L=hindi ;;
	ho)	L=hiri_motu ;;
	hr)	L=croatian ;;
	ht)	L=haitian ;;
	hu)	L=hungarian ;;
	hy)	L=armenian ;;
	hz)	L=herero ;;
	ia)	L=interlingua ;;
	ie)	L=interlingue ;;
	id)	L=indonesian ;;
	ig)	L=igbo ;;
	ii)	L=nuosu ;;
	ik)	L=inupiaq ;;
	io)	L=ido ;;
	is)	L=icelandic ;;
	it)	L=italian ;;
	iu)	L=inuktitut ;;
	ja)	L=japanese ;;
	jv)	L=javanese ;;
	ka)	L=georgian ;;
	kg)	L=kongo ;;
	ki)	L=gikuyu ;;
	kj)	L=kuanyama ;;
	kk)	L=kazakh ;;
	kl)	L=greenlandic ;;
	km)	L=central_khmer ;;
	kn)	L=kannada ;;
	ko)	L=korean ;;
	kr)	L=kanuri ;;
	ks)	L=kashmiri ;;
	kv)	L=komi ;;
	kw)	L=cornish ;;
	ky)	L=kirghiz ;;
	la)	L=latin ;;
	lb)	L=luxembourgish ;;
	lg)	L=ganda ;;
	li)	L=limburgan ;;
	ln)	L=lingala ;;
	lo)	L=lao ;;
	lt)	L=lithuanian ;;
	lu)	L=luba-katanga ;;
	lv)	L=latvian ;;
	mh)	L=mashallese ;;
	mg)	L=malagasy ;;
	mi)	L=maori ;;
	mk)	L=macedonian ;;
	ml)	L=malayalam ;;
	mn)	L=mongolian ;;
	mr)	L=marathi ;;
	ms)	L=malay ;;
	mt)	L=maltese ;;
	my)	L=burmese ;;
	na)	L=nauru ;;
	nb)	L=norwegian_bokmål ;;
	nd)	L=ndebele_north ;;
	ne)	L=nepali ;;
	ng)	L=ndonga ;;
	nl)	L=dutch ;;
	nn)	L=norwegian_nynorsk ;;
	no)	L=norwegian ;;
	nr)	L=ndebele_south ;;
	nv)	L=navajo ;;
	ny)	L=chichewa ;;
	oc)	L=occitan ;;
	oj)	L=ojibwa ;;
	om)	L=oromo ;;
	or)	L=oriya ;;
	os)	L=ossetian ;;
	pa)	L=panjabi ;;
	pi)	L=pali ;;
	pl)	L=polish ;;
	ps)	L=pushto ;;
	pt)	L=portuguese ;;
	qu)	L=quechua ;;
	rm)	L=romansh ;;
	rn)	L=rundi ;;
	ro)	L=romanian ;;
	ru)	L=russian ;;
	rw)	L=kinyarwanda ;;
	sa)	L=sanskrit ;;
	sc)	L=sardinian ;;
	sd)	L=sindi ;;
	se)	L=nothern_sami ;;
	sg)	L=sango ;;
	sk)	L=slovak ;;
	sl)	L=slovenian ;;
	sm)	L=samoan ;;
	sn)	L=shona ;;
	so)	L=somali ;;
	sq)	L=albanian ;;
	sr)	L=serbian ;;
	ss)	L=swati ;;
	st)	L=sotho_southern ;;
	su)	L=sundanese ;;
	sv)	L=swedish ;;
	sw)	L=swahili ;;
	ta)	L=tamil ;;
	te)	L=telugu ;;
	tg)	L=tajik ;;
	th)	L=thai ;;
	ti)	L=tigrinya ;;
	tk)	L=turkmen ;;
	tl)	L=tagalog ;;
	tn)	L=tswana ;;
	to)	L=tonga ;;
	tr)	L=turkish ;;
	ts)	L=tsonga ;;
	tt)	L=tatar ;;
	tw)	L=twi ;;
	ty)	L=tahitian ;;
	ug)	L=uighur ;;
	uk)	L=ukrainian ;;
	ur)	L=urdu ;;
	uz)	L=uzbek ;;
	ve)	L=venda ;;
	vi)	L=vietnamese ;;
	vo)	L=volapük ;;
	wa)	L=walloon ;;
	wo)	L=wolof ;;
	xh)	L=xhosa ;;
	yi)	L=yiddish ;;
	yo)	L=yoruba ;;
	za)	L=zhuang ;;
	zh)	L=chinese ;;		
	zu)	L=zulu ;;
	*)	L=english ;; #just in case
esac
export LANGUAGE=$L
. $APPDIR/locals/english #always run to fill gaps in translation
. $APPDIR/locals/$LANGUAGE 2> /dev/null

. $APPDIR/func -probe

#GUI_COPY="<visible>disabled</visible>"
#PBURN_VERSION=`grep VERSION $HOME/.pburn/pburnrc | sed -e s/^.*\=//g | tr -d "."`
#[ "$PBURN_VERSION" -gt "239" ] && GUI_COPY="<action>pburn -m copy-audio-cd &</action><visible>enabled</visible>"

export pcd="
<window title=\"pcd - $LOC200\" icon-name=\"gtk-media-stop\">
<vbox>
 <hbox homogeneous=\"true\">
  <vbox>
   <hbox>
    <button>
     <label>$LOC201</label>
     <variable>COPY_DISC</variable>
     <action>pburn -m copy-audio-cd &</action>
    </button>
    <button>
     <label>$LOC202</label>
     <variable>Rip_DISC</variable>
     <action>$APPDIR/func -rip</action>
    </button>
    <text><label>\"  \"</label></text>
    <button>
     <input file stock=\"gtk-media-previous\"></input>
     <action signal=\"enter\">ptooltips \"$LOC800\" &</action>
     <action signal=\"leave\">ptooltips -end &</action>
     <action>$APPDIR/func -previous</action>
    </button>
    <button>
     <input file stock=\"gtk-media-stop\"></input>
     <action signal=\"enter\">ptooltips \"$LOC801\" &</action>
     <action signal=\"leave\">ptooltips -end &</action>
     <action>$APPDIR/func -stop</action>
    </button>
    <button>
     <input file stock=\"gtk-media-play\"></input>
     <action signal=\"enter\">ptooltips \"$LOC802\" &</action>
     <action signal=\"leave\">ptooltips -end &</action>
     <action>echo \$CDDA > \$WORKDIR/pcd-nr; $APPDIR/func -play &</action>
    </button>
    <button>
     <input file stock=\"gtk-media-next\"></input>
     <action signal=\"enter\">ptooltips \"$LOC803\" &</action>
     <action signal=\"leave\">ptooltips -end &</action>
     <action>$APPDIR/func -next</action>
    </button>
    <text><label>\"  \"</label></text>
    <button>
     <label>$LOC203</label>
     <action>$APPDIR/func -probe</action>
     <action>refresh:ENTRY_ARTIST</action>
     <action>refresh:ENTRY_ALBUM</action>
     <action>refresh:CDDA</action>
    </button>
    <button>
     <label>$LOC204</label>
     <action>$APPDIR/func -stop</action>
     <action>eject</action>
    </button>
   </hbox>
  </vbox>
 </hbox>
 <progressbar>
  <label>\" \"</label>
  <input>"'while [ "$(ps | grep '/pcd')" ]; do cat '"$WORKDIR"'/pcd-playing 2> /dev/null; sleep 3; done'"</input>
 </progressbar>
 <frame>
  <hbox>
   <text width_request=\"60\"><label>$LOC205</label></text>
   <entry editable=\"false\"><input>cat $WORKDIR/pcd-ARTIST</input><variable>ENTRY_ARTIST</variable></entry>
  </hbox>
  <hbox>
   <text width_request=\"60\"><label>$LOC206</label></text>
   <entry editable=\"false\"><input>cat $WORKDIR/pcd-ALBUM</input><variable>ENTRY_ALBUM</variable></entry>
  </hbox>
  <tree headers_visible=\"false\" rules_hint=\"true\">
   <height>300</height><width>100</width>
   <label>$LOC207|$LOC208|$LOC209</label>
   <input>cat $WORKDIR/pcd-cdda</input>
   <variable>CDDA</variable>
   <action>echo \$CDDA > \$WORKDIR/pcd-nr</action>
   <action>disable:READ_DISC</action>
   <action>disable:EJECT</action>
   <action>. $APPDIR/func -play &</action>
  </tree>
 </frame>
 <hbox>
  <button>
   <label>$LOC210</label>
   <input file icon=\"gtk-cancel\"></input>
   <action type=\"exit\">cancel</action>
  </button>
 </hbox>
</vbox>
</window>"

gtkdialog3 --program=pcd
. $APPDIR/func -stop
#in case stopping in pause beetween tracks
sleep 2
. $APPDIR/func -stop
for I in `ps | grep pcd | grep while | awk '{print $1}'`; do kill -9 $I 2> /dev/null; done
for I in `ps | grep pcd_splash | awk '{print $1}'`; do kill -9 $I 2> /dev/null; done


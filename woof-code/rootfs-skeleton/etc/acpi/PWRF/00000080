#!/bin/ash

. /etc/rc.d/f4puppy5

#aplay /usr/share/audio/2barks.au

Version='1.0 Macpup_O2-Puppy_Linux_431 KRG'

usage(){
MSG="
$0

OPTIONS:
[help|version]
[checkcode|debug|verbose]
[hiber|sleep|resume=/dev/SWAP|/dev/SWAP]

Available Modes :
$KERN_VER
$AVAIL_MODES
"
echo "$MSG"
[ "$DISPLAY" ] && xmessage -bg white4 "$MSG"
exit $1
}

__available_modes__(){
pidof sync >>$OUT || sync

KERN_VER=`uname -r`
#AVAIL_MODES=$(</sys/power/state)
read AVAIL_MODES </sys/power/state
BUTTONS="Let me outa here:200"
for m in $AVAIL_MODES;do
case $m in
standby)
BUTTONS="Powerdown to Standby:201,${BUTTONS}"
;;
mem)
BUTTONS="REST in RAM:203,${BUTTONS}"
;;
disk)
BUTTONS="Hiber on DISK:204,${BUTTONS}"
;;
esac;done
}

out=/dev/null;err=$out
HIBER=1;MODE=DISK;mode=disk
for param in $@;do
case $1 in

*version) echo -e "\n$0: Version '$Version'\nTry help for more info\n";exit 0;;
*help) usage 0;;

*checkcode|*codecheck)   set -n; shift;;
*debug)                  set -x; shift;;
*verbose) VERBOSE=1;VERB=-v;L_VERB=--verbose;A_VERB=-verbose;out=/dev/stdout;err=/dev/stderr;shift;;

*hiber) HIBER=1;MODE=DISK;mode=disk; shift;;
*sleep) SLEEP=1;MODE=RAM;mode=mem;   shift;;
resume=/dev/*) SWAP_TO_USE=${1#*=};  shift;;
/dev/*) SWAP_TO_USE=$1;              shift;;

*) :;;

esac;done

echo "$0"

pidof sync >>$OUT || sync

#if [ "$DISPLAY" ];then
if pidof X; then
exec /etc/acpi/PWRF/00000080.X "$@"
exit

else #X not running, read console


#exec cttyhack /etc/acpi/PWRF/00000080.TERM
exec openvt -s -w /etc/acpi/PWRF/00000080.TERM "$@"
exit

fi #pidof X

###END###

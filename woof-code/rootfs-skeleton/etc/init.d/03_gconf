#!/bin/ash

GCONF_DEBUG_OUTPUT=/tmp/gconfd.log
export GCONF_DEBUG_OUTPUT

DAEMON=/usr/local/libexec/gconfd-2
PARAM="$1"
[ "$1" ] || PARAM='none'
case $PARAM in
start)
pids=`/bin/ps -C gconfd-2 | awk '{print $1}' | grep -o '^[0-9]\+'`
for pid in $pids ; do
echo $pid
for i in `seq 1 1 64`; do
#ps -p $pid
#ps -p $pid | sed '1 d'
[ ! "`/bin/ps -p $pid | sed '1 d'`" ] && echo && break
echo -n "$i."
kill -$i $pid;sleep 2.5s
done
done
/usr/local/libexec/gconfd-2 &
#/usr/local/libexec/gconfd-2 --spawn
#gconftool-2 --spawn
#/usr/bin/gconftool-2 --spawn
#/usr/local/bin/gconftool-2 --spawn
pid=`/bin/ps -C gconfd-2`
echo "$pid"
pid=`/bin/ps --no-header -C gconfd-2`
if [ "$pid" ];then
echo "/usr/local/libexec/gconfd-2 & sarted with
$pid"
else
echo "Starting of /usr/local/libexec/gconfd-2 failed ."
fi
;;
stop)
pids=`/bin/ps -C gconfd-2 | awk '{print $1}' | grep -o '^[0-9]\+'`
for pid in $pids ; do
echo $pid
for i in `seq 1 1 64`; do
[ ! "`/bin/ps -p $pid | sed '1 d'`" ] && echo && break
echo -n "$i."
kill -$i $pid;sleep 2.5s
done
done
#/usr/local/libexec/gconfd-2 --shutdown
#gconftool-2 --shutdown
#/usr/bin/gconftool-2 --shutdown
#/usr/local/bin/gconftool-2 --shutdown
;;
check)
/bin/ps acx | grep gconf
echo '---------------'
gconftool-2 -p
RTVAL="$?";echo "$RTVAL"
if [ "$RTVAL" == '0' ];then
echo "gfonfd is running"
elif [ "$RTVAL" == '2' ];then
echo "gconfd not running"
else
echo "gconfd state <$RTVAL> unknown to $0"
fi
echo
;;
*)
echo "$PARAM invalid . Valid parameters are start|stop|check"
exit 1
;;
esac
exit 0
